<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OASF Record Generator</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📦</text></svg>" />
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #f8fafc;
        --fg: #1e293b;
        --container-bg: #ffffff;
        --primary: #187adc;
        --primary-hover: #146bb8;
        --primary-light: #e8f4fd;
        --accent: #10b981;
        --accent-hover: #059669;
        --accent-light: #d1fae5;
        --danger: #ef4444;
        --danger-hover: #dc2626;
        --danger-light: #fee2e2;
        --warning: #f59e0b;
        --warning-light: #fef3c7;
        --border-color: #e2e8f0;
        --border-hover: #cbd5e1;
        --input-bg: #ffffff;
        --input-fg: #1e293b;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1),
          0 4px 6px -4px rgb(0 0 0 / 0.1);
        --radius: 8px;
        --radius-lg: 12px;
        --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);

        /* Legacy variables for compatibility */
        --background: #f8fafc;
        --foreground: #1e293b;
        --card: #ffffff;
        --card-foreground: #1e293b;
        --border: #e2e8f0;
        --muted: #f1f5f9;
        --muted-foreground: #64748b;
        --ring: #1e293b;
      }

      [data-theme="dark"] {
        --bg: #0f172a;
        --fg: #f1f5f9;
        --container-bg: #1e293b;
        --primary: #187adc;
        --primary-hover: #146bb8;
        --primary-light: #0f2951;
        --accent: #10b981;
        --accent-hover: #059669;
        --accent-light: #064e3b;
        --danger: #ef4444;
        --danger-hover: #dc2626;
        --danger-light: #7f1d1d;
        --warning: #f59e0b;
        --warning-light: #78350f;
        --border-color: #334155;
        --border-hover: #475569;
        --input-bg: #334155;
        --input-fg: #f1f5f9;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
        --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.3), 0 1px 2px -1px rgb(0 0 0 / 0.3);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.3),
          0 4px 6px -4px rgb(0 0 0 / 0.3);

        /* Legacy variables for compatibility */
        --background: #0f172a;
        --foreground: #f1f5f9;
        --card: #1e293b;
        --card-foreground: #f1f5f9;
        --border: #334155;
        --muted: #1e293b;
        --muted-foreground: #94a3b8;
        --ring: #f1f5f9;
      }
      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background: var(--bg);
        color: var(--fg);
        margin: 0;
        padding: 24px;
        transition: var(--transition);
        line-height: 1.6;
        min-height: 100vh;
      }
      .extension-tile {
        transition: var(--transition);
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      .extension-tile:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }
      .extension-tile::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        opacity: 0;
        transition: var(--transition);
      }
      .extension-tile:hover::before {
        opacity: 1;
      }
      .extension-card {
        transition: var(--transition);
        border-left: 4px solid var(--primary);
      }
      .extension-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        font-size: 12px;
        margin-bottom: 8px;
      }
      .a2a-icon {
        background: linear-gradient(
          135deg,
          hsl(269, 100%, 78%) 0%,
          hsl(213, 89%, 64%) 100%
        );
      }
      .model-icon {
        background: linear-gradient(
          135deg,
          hsl(338, 95%, 75%) 0%,
          hsl(269, 100%, 78%) 100%
        );
      }
      .mcp-icon {
        background: linear-gradient(
          135deg,
          hsl(26, 91%, 65%) 0%,
          hsl(338, 95%, 75%) 100%
        );
      }
      .prompt-icon {
        background: linear-gradient(
          135deg,
          hsl(133, 72%, 59%) 0%,
          hsl(169, 84%, 61%) 100%
        );
      }
      .observability-icon {
        background: linear-gradient(
          135deg,
          hsl(179, 78%, 78%) 0%,
          hsl(326, 78%, 85%) 100%
        );
      }
      .evaluation-icon {
        background: linear-gradient(
          135deg,
          hsl(35, 77%, 62%) 0%,
          hsl(179, 78%, 78%) 100%
        );
      }
      .custom-icon {
        background: linear-gradient(
          135deg,
          hsl(0, 6%, 78%) 0%,
          hsl(0, 6%, 78%) 100%
        );
      }
      .card {
        background-color: var(--container-bg);
        color: var(--fg);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        box-shadow: var(--shadow-sm);
      }

      button {
        margin-top: 24px;
        padding: 12px 24px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 600;
        transition: var(--transition);
        box-shadow: var(--shadow-sm);
      }

      button:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow);
      }

      button:active {
        transform: translateY(0);
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius);
        font-size: 0.875rem;
        font-weight: 600;
        transition: var(--transition);
        cursor: pointer;
        border: none;
        text-decoration: none;
        padding: 12px 24px;
        background: var(--primary);
        color: white;
        box-shadow: var(--shadow-sm);
        margin-top: 24px;
      }
      .btn:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow);
      }
      .btn-primary {
        background: var(--primary);
        color: white;
      }
      .btn-primary:hover {
        background: var(--primary-hover);
      }
      .btn-secondary {
        background: var(--border-color);
        color: var(--fg);
      }
      .btn-secondary:hover {
        background: var(--primary-hover);
        color: white;
      }
      .btn-destructive {
        background: var(--danger);
        color: white;
      }
      .btn-destructive:hover {
        background: var(--danger-hover);
      }
      .btn-ghost {
        background-color: transparent;
        color: var(--fg);
        padding: 6px 12px;
      }
      .btn-ghost:hover {
        background-color: var(--border-color);
      }

      .btn-cancel {
        background: var(--border-color);
        color: var(--fg);
      }
      .btn-cancel:hover {
        background: var(--danger);
        color: white;
      }

      \ .btn-danger {
        background: var(--danger) !important;
        color: white !important;
      }
      .btn-danger:hover {
        background: var(--danger-hover) !important;
      }
      .btn-small {
        padding: 6px 12px !important;
        font-size: 0.75rem !important;
        margin-top: 8px !important;
      }
      .btn-full {
        width: 100% !important;
      }

      label {
        font-weight: 600;
        display: block;
        margin-top: 20px;
        margin-bottom: 8px;
        color: var(--fg);
        font-size: 0.875rem;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px 16px;
        margin-top: 4px;
        border: 2px solid var(--border-color);
        border-radius: var(--radius);
        background: var(--input-bg);
        color: var(--input-fg);
        font-size: 0.875rem;
        transition: var(--transition);
        box-sizing: border-box;
        line-height: 1.4;
      }

      select {
        min-height: 2.5rem;
      }

      select option {
        padding: 8px 12px;
        background-color: var(--input-bg);
        color: var(--input-fg);
        line-height: 1.4;
        white-space: nowrap;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px var(--primary-light);
      }

      input:hover,
      select:hover,
      textarea:hover {
        border-color: var(--border-hover);
      }

      /* Legacy input classes for compatibility */
      .input {
        display: flex;
        height: 2.5rem;
        width: 100%;
        border-radius: var(--radius);
        border: 2px solid var(--border-color);
        background-color: var(--input-bg);
        color: var(--input-fg);
        padding: 12px 16px;
        font-size: 0.875rem;
        transition: var(--transition);
      }
      .input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px var(--primary-light);
      }
      .textarea {
        display: flex;
        min-height: 5rem;
        width: 100%;
        border-radius: var(--radius);
        border: 2px solid var(--border-color);
        background-color: var(--input-bg);
        color: var(--input-fg);
        padding: 12px 16px;
        font-size: 0.875rem;
        transition: var(--transition);
        resize: vertical;
      }
      .textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px var(--primary-light);
      }
      .select {
        display: block;
        min-height: 2.5rem;
        width: 100%;
        border-radius: var(--radius);
        border: 2px solid var(--border-color);
        background-color: var(--input-bg);
        color: var(--input-fg);
        padding: 12px 16px;
        font-size: 0.875rem;
        transition: var(--transition);
        line-height: 1.4;
      }
      .select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px var(--primary-light);
      }
      .select option {
        padding: 8px 12px;
        background-color: var(--input-bg);
        color: var(--input-fg);
        line-height: 1.4;
        white-space: nowrap;
      }
      .label {
        font-weight: 600;
        display: block;
        margin-top: 20px;
        margin-bottom: 8px;
        color: var(--fg);
        font-size: 0.875rem;
      }
      .text-muted-foreground {
        color: var(--fg);
        opacity: 0.7;
      }
      .text-destructive {
        color: var(--danger);
      }
      .bg-muted {
        background-color: var(--border-color);
      }
      .border {
        border: 1px solid var(--border-color);
      }
      .hidden {
        display: none;
      }
      .flex {
        display: flex;
      }
      .grid {
        display: grid;
      }
      .items-center {
        align-items: center;
      }
      .justify-between {
        justify-content: space-between;
      }
      .gap-2 {
        gap: 0.5rem;
      }
      .gap-3 {
        gap: 0.75rem;
      }
      .gap-4 {
        gap: 1rem;
      }
      .gap-6 {
        gap: 1.5rem;
      }
      .p-4 {
        padding: 1rem;
      }
      .p-6 {
        padding: 1.5rem;
      }
      .px-4 {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      .py-2 {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
      }
      .mb-2 {
        margin-bottom: 0.5rem;
      }
      .mb-3 {
        margin-bottom: 0.75rem;
      }
      .mb-4 {
        margin-bottom: 1rem;
      }
      .mb-6 {
        margin-bottom: 1.5rem;
      }
      .mb-8 {
        margin-bottom: 2rem;
      }
      .rounded {
        border-radius: calc(var(--radius) - 2px);
      }
      .rounded-lg {
        border-radius: var(--radius);
      }
      .font-semibold {
        font-weight: 600;
      }
      .font-bold {
        font-weight: 700;
      }
      .text-sm {
        font-size: 0.875rem;
        line-height: 1.25rem;
      }
      .text-lg {
        font-size: 1.125rem;
        line-height: 1.75rem;
      }
      .text-xl {
        font-size: 1.25rem;
        line-height: 1.75rem;
      }
      .text-2xl {
        font-size: 1.5rem;
        line-height: 2rem;
      }
      .text-3xl {
        font-size: 1.875rem;
        line-height: 2.25rem;
      }
      .w-full {
        width: 100%;
      }
      .h-auto {
        height: auto;
      }
      .max-w-6xl {
        max-width: 72rem;
      }
      .mx-auto {
        margin-left: auto;
        margin-right: auto;
      }
      .container {
        width: 100%;
        margin-left: auto;
        margin-right: auto;
        padding-left: 1rem;
        padding-right: 1rem;
      }

      /* Dynamic list and skills styling */
      .dynamic-list-container {
        margin-bottom: 10px;
      }

      .dynamic-list-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        gap: 8px;
      }

      .dynamic-list-item input {
        flex: 1;
      }

      .skill-container {
        border: 2px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 24px;
        margin-bottom: 20px;
        background: var(--container-bg);
        transition: var(--transition);
        box-shadow: var(--shadow-sm);
      }

      .skill-container:hover {
        border-color: var(--border-hover);
        box-shadow: var(--shadow);
      }

      /* JSON Syntax Highlighting */
      pre.json-output {
        background: #1e1e1e;
        color: #f8f8f2;
        padding: 16px;
        border-radius: 6px;
        overflow-x: auto;
        font-size: 13px;
        white-space: pre-wrap;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
      }

      .json-string {
        color: #c3e88d;
      }

      .json-number {
        color: #82aaff;
      }

      .json-boolean {
        color: #ffcb6b;
      }

      .json-null {
        color: #f78c6c;
      }

      .json-key {
        color: #c792ea;
      }

      /* A2A Card Loader Styles */
      .url-input-container {
        margin-bottom: 24px;
      }

      /* Drag and Drop Styles */
      .drag-over {
        border: 2px dashed var(--primary) !important;
        background-color: var(--primary-light) !important;
        transition: all 0.2s ease-in-out;
      }

      .drop-zone-message {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: var(--container-bg);
        border: 2px dashed var(--primary);
        border-radius: var(--radius);
        padding: 20px;
        text-align: center;
        z-index: 1000;
        box-shadow: var(--shadow-lg);
      }

      .drag-over .drop-zone-message {
        display: block;
      }

      /* Custom overlay background for modal dialogs */
      .overlay-bg {
        background-color: rgba(0, 0, 0, 0.5);
      }

      /* Dark mode specific styles */
      .dark .overlay-bg {
        background-color: rgba(0, 0, 0, 0.8);
      }

      .url-input {
        width: 100%;
        padding: 16px;
        border: 2px solid var(--border-color);
        border-radius: var(--radius);
        font-size: 0.875rem;
        min-height: 120px;
        max-height: 400px;
        box-sizing: border-box;
        resize: vertical;
        overflow-y: auto;
        font-family: "JetBrains Mono", "Fira Code", Consolas, monospace;
        line-height: 1.6;
        transition: var(--transition);
        white-space: pre;
        background-color: var(--input-bg);
        color: var(--input-fg);
      }

      .url-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px var(--primary-light);
      }

      .url-input:hover {
        border-color: var(--border-hover);
      }

      .example-link {
        margin-bottom: 12px;
        font-size: 0.875rem;
        padding: 12px;
        background: var(--primary-light);
        border-radius: var(--radius);
        border: 1px solid var(--border-color);
      }

      .example-link a {
        word-break: break-all;
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
      }

      .example-link a:hover {
        text-decoration: underline;
      }

      .url-button {
        padding: 12px 20px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        height: 48px;
        min-width: 160px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.875rem;
        box-shadow: var(--shadow-sm);
        margin-top: 12px;
      }

      .url-button:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow);
      }

      .url-button:disabled {
        background: var(--border-color);
        color: var(--fg);
        cursor: not-allowed;
        opacity: 0.6;
        transform: none;
        box-shadow: none;
      }

      .url-button-content {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
      }

      .loading-spinner {
        border: 2px solid transparent;
        border-top: 2px solid currentColor;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .text-primary {
        color: var(--primary);
      }

      /* Grid utilities */
      .grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .space-y-2 > * + * {
        margin-top: 0.5rem;
      }

      .space-y-3 > * + * {
        margin-top: 0.75rem;
      }

      .space-y-4 > * + * {
        margin-top: 1rem;
      }

      .flex-1 {
        flex: 1 1 0%;
      }

      *:focus-visible {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
      }

      .text-muted-foreground {
        color: var(--fg);
        opacity: 0.7;
      }
      .text-destructive {
        color: var(--danger);
      }
      .bg-muted {
        background-color: var(--border-color);
      }
      .border {
        border: 1px solid var(--border-color);
      }

      /* URL input specific styling */
      .url-input {
        width: 100%;
        padding: 16px;
        border: 2px solid var(--border-color);
        border-radius: var(--radius);
        font-size: 0.875rem;
        min-height: 120px;
        max-height: 400px;
        box-sizing: border-box;
        resize: vertical;
        overflow-y: auto;
        font-family: "JetBrains Mono", "Fira Code", Consolas, monospace;
        line-height: 1.6;
        transition: var(--transition);
        white-space: pre;
        background-color: var(--input-bg);
        color: var(--input-fg);
      }

      .url-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px var(--primary-light);
      }

      .url-input:hover {
        border-color: var(--border-hover);
      }

      /* Example link styling */
      .example-link {
        margin-bottom: 12px;
        font-size: 0.875rem;
        padding: 12px;
        background: var(--primary-light);
        border-radius: var(--radius);
        border: 1px solid var(--border-color);
      }

      .example-link a {
        word-break: break-all;
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
      }

      .example-link a:hover {
        text-decoration: underline;
      }

      /* Loading spinner */
      .loading-spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left: 4px solid var(--primary);
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
        margin-right: 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Error messages */
      .error-message {
        background: var(--danger-light);
        color: var(--danger);
        padding: 16px;
        border-radius: var(--radius);
        margin-bottom: 20px;
        border-left: 4px solid var(--danger);
        font-weight: 500;
        box-shadow: var(--shadow-sm);
      }

      .toast-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 8px;
        pointer-events: none;
      }

      .toast {
        background: var(--primary);
        color: white;
        padding: 8px 16px;
        border-radius: var(--radius);
        box-shadow: var(--shadow-lg);
        font-size: 0.8rem;
        font-weight: 400;
        display: flex;
        align-items: center;
        gap: 8px;
        transform: translateX(100%);
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        pointer-events: auto;
        max-width: 280px;
        word-wrap: break-word;
      }

      .toast.show {
        transform: translateX(0);
        opacity: 1;
      }

      .toast.success {
        background: var(--primary);
      }

      .toast.error {
        background: var(--danger);
      }

      .toast.warning {
        background: var(--primary);
      }

      .toast-close-button {
        background: none;
        border: none;
        color: white;
        font-size: 14px;
        font-weight: normal;
        cursor: pointer;
        padding: 0;
        margin-left: auto;
        width: 16px;
        height: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 2px;
        opacity: 0.8;
        transition: opacity 0.2s ease;
      }

      .toast-close-button:hover {
        opacity: 1;
        background: rgba(255, 255, 255, 0.1);
      }

      .toast-close-button:focus {
        outline: 2px solid rgba(255, 255, 255, 0.5);
        outline-offset: 1px;
      }

      /* Loading spinner styles */
      .spinner {
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      @media (min-width: 640px) {
        .container {
          max-width: 640px;
        }
        .grid-cols-2 {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }
      @media (min-width: 768px) {
        .container {
          max-width: 768px;
        }
        .md\\:grid-cols-3 {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
      }
      @media (min-width: 1024px) {
        .container {
          max-width: 1024px;
        }
        .lg\\:grid-cols-4 {
          grid-template-columns: repeat(4, minmax(0, 1fr));
        }
      }
      @media (min-width: 1280px) {
        .container {
          max-width: 1280px;
        }
        .xl\\:grid-cols-5 {
          grid-template-columns: repeat(5, minmax(0, 1fr));
        }
      }
      .space-y-4 > * + * {
        margin-top: 1rem;
      }
      .max-h-80 {
        max-height: 20rem;
      }
      .max-h-96 {
        max-height: 24rem;
      }
      .overflow-auto {
        overflow: auto;
      }
      .fixed {
        position: fixed;
      }
      .inset-0 {
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
      .z-50 {
        z-index: 50;
      }
      .bg-black {
        background-color: rgb(0 0 0);
      }
      .bg-opacity-50 {
        background-color: rgb(0 0 0 / 0.5);
      }
      .ml-1 {
        margin-left: 0.25rem;
      }
      .mt-1 {
        margin-top: 0.25rem;
      }
      .block {
        display: block;
      }
      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 100;
      }
      .mx-auto {
        margin-left: auto;
        margin-right: auto;
      }
      .text-center {
        text-align: center;
      }
      .text-xs {
        font-size: 0.75rem;
        line-height: 1rem;
      }
      .leading-tight {
        line-height: 1.25;
      }
      .grid-cols-6 {
        grid-template-columns: repeat(6, minmax(0, 1fr));
      }
      @media (max-width: 768px) {
        .grid-cols-6 {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
      }
      @media (max-width: 480px) {
        .grid-cols-6 {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      // Default OASF Schema Version
      const DEFAULT_OASF_VERSION = "0.5.0";

      // Function to fetch the latest OASF version
      const fetchLatestOASFVersion = async () => {
        try {
          const response = await fetch("https://schema.oasf.outshift.com/api/version");
          const data = await response.json();
          return data.version;
        } catch (error) {
          console.error("Error fetching OASF version:", error);
          return "0.5.0"; // Default fallback version
        }
      };

      // Function to fetch schema for a specific feature
      const fetchFeatureSchema = async (feature, version) => {
        try {
          const schemaUrl = `https://schema.oasf.outshift.com/schema/${version}/features/${feature}?profiles=`;

          const schemaResponse = await fetch(schemaUrl);
          const schemaData = await schemaResponse.json();

          const exampleUrl = `https://schema.oasf.outshift.com/sample/${version}/features/${feature}?profiles=`;

          const exampleResponse = await fetch(exampleUrl);
          const exampleData = await exampleResponse.json();

          console.log(`Schema URL: ${schemaUrl}`);
          console.log(`Example URL: ${exampleUrl}`);

          return { schema: schemaData, example: exampleData };
        } catch (error) {
          console.error(`Error fetching schema for ${feature}:`, error);
          return { schema: null, example: null };
        }
      };

      // Helper function to convert schema type to field type
      const schemaTypeToFieldType = (type, format, enumValues) => {
        if (enumValues && Array.isArray(enumValues)) return "select";
        if (type === "string") {
          if (format === "uri" || format === "url") return "url";
          if (format === "password") return "password";
          return "text";
        }
        if (type === "number" || type === "integer") return "number";
        if (type === "boolean") return "checkbox";
        if (type === "array") return "dynamic-list";
        if (type === "object") return "json-textarea";
        return "text";
      };

      // Helper function to resolve $ref in schema
      const resolveSchemaRef = (refSchema, schema) => {
        if (refSchema.$ref && typeof refSchema.$ref === 'string') {
          // Extract the path from the $ref, e.g., "#/$defs/objects/mcp_server_data"
          const refPath = refSchema.$ref.replace('#/', '').split('/');

          // Navigate through the schema to find the referenced object
          let resolvedSchema = schema;
          for (const pathPart of refPath) {
            if (resolvedSchema[pathPart]) {
              resolvedSchema = resolvedSchema[pathPart];
            } else {
              console.error(`Could not resolve $ref path part: ${pathPart} in ${refSchema.$ref}`);
              return refSchema; // Return original if can't resolve
            }
          }

          console.log(`Resolved $ref ${refSchema.$ref} to:`, resolvedSchema);
          return resolvedSchema;
        }
        return refSchema;
      };

      // Helper function to process additional properties from $defs
      const processAdditionalProperties = (schema) => {
        // Check if schema has $defs section with objects
        if (schema.$defs && schema.$defs.objects) {
          const additionalFields = [];

          // Process each object in $defs.objects
          for (const [objectName, objectSchema] of Object.entries(schema.$defs.objects)) {
            console.log(`Processing additional properties from $defs.objects.${objectName}`);

            // Check if the object has properties
            if (objectSchema.properties) {
              // Process each property in the object
              for (const [propName, propSchema] of Object.entries(objectSchema.properties)) {
                // Skip certain properties that shouldn't be directly editable
                if (propName === "type" || propName === "$schema") continue;

                const fieldType = schemaTypeToFieldType(
                  propSchema.type,
                  propSchema.format,
                  propSchema.enum
                );

                const field = {
                  key: `${objectName}_${propName}`,
                  label: propSchema.title || `${objectName}: ${propName.charAt(0).toUpperCase() + propName.slice(1).replace(/_/g, ' ')}`,
                  type: fieldType,
                  required: objectSchema.required && objectSchema.required.includes(propName),
                  description: propSchema.description || "",
                  group: objectName, // Add a group to organize fields
                };

                // Add options for select fields
                if (fieldType === "select" && propSchema.enum) {
                  field.options = propSchema.enum;
                }

                // Add min/max for number fields
                if (fieldType === "number") {
                  if (propSchema.minimum !== undefined) field.min = propSchema.minimum.toString();
                  if (propSchema.maximum !== undefined) field.max = propSchema.maximum.toString();
                  if (propSchema.multipleOf !== undefined) field.step = propSchema.multipleOf.toString();
                }

                additionalFields.push(field);
              }
            }
          }

          return additionalFields;
        }

        return [];
      };

      // Function to update extensionConfigs based on schema
      const updateExtensionConfigsFromSchema = async (version, setOasfVersion) => {
        console.log(`Using OASF version: ${version}`);

        // Features to update (excluding Manifest as requested)
        // Reordered to prioritize MCP as the second extension
        const features = ['mcp', 'observability', 'evaluation', 'model', 'prompt'];

        for (const feature of features) {
          const { schema, example } = await fetchFeatureSchema(feature, version);

          if (schema && schema.properties) {
            // Update the schema information for this feature
            console.log(`Updating schema for ${feature}`);

            // Make sure the feature exists in extensionConfigs
            if (!extensionConfigs[feature]) {
              // Create a new entry if it doesn't exist
              extensionConfigs[feature] = {
                name: feature.charAt(0).toUpperCase() + feature.slice(1),
                icon: feature === 'model' ? '🧠' :
                      feature === 'prompt' ? '💬' :
                      feature === 'mcp' ? '🔌' :
                      feature === 'evaluation' ? '📊' :
                      feature === 'observability' ? '👁️' : '📦',
                iconClass: `${feature}-icon`,
                description: schema.description || `${feature.charAt(0).toUpperCase() + feature.slice(1)} configuration`,
                fields: []
              };
            }

            // Update the schemaName to reflect the latest version
            extensionConfigs[feature].schemaName = `schema.oasf.outshift.com/${version}/features/${feature}`;

            // Parse schema properties and update fields
            const fields = [];

            // Process additional properties from $defs section (especially for MCP)
            if (feature === 'mcp') {
              console.log('Processing additional properties for MCP schema');

              // Add name and version fields first (these are top-level properties)
              fields.push({
                key: "name",
                label: "Server Name",
                type: "text",
                required: true,
                description: "Name of the MCP server",
              });

              fields.push({
                key: "version",
                label: "Version",
                type: "text",
                required: false,
                description: "Version of the MCP server",
              });

              // Process server configuration fields from $defs
              const additionalFields = processAdditionalProperties(schema);
              if (additionalFields.length > 0) {
                console.log(`Found ${additionalFields.length} additional fields from $defs`);

                // Add section headers for each group of additional fields
                const groups = {};
                additionalFields.forEach(field => {
                  if (!groups[field.group]) {
                    groups[field.group] = true;
                    fields.push({
                      key: `${field.group}-header`,
                      label: "",
                      type: "h4-header",
                      content: `${field.group.charAt(0).toUpperCase() + field.group.slice(1).replace(/_/g, ' ')} Configuration`,
                      required: false,
                    });
                  }
                });

                // Add the additional fields
                fields.push(...additionalFields);
              }

              // If data property has a $ref, process it specially
              if (schema.properties.data && schema.properties.data.$ref) {
                console.log(`Processing data reference: ${schema.properties.data.$ref}`);
                const resolvedData = resolveSchemaRef(schema.properties.data, schema);

                // If resolvedData has a servers property that's an array of server configurations
                if (resolvedData && resolvedData.properties && resolvedData.properties.servers) {
                  console.log('Found servers property in data reference');

                  // Add a header for server configurations
                  fields.push({
                    key: "servers-header",
                    label: "",
                    type: "h4-header",
                    content: "Server Configurations",
                    required: false,
                  });

                  // Add a note about server configurations
                  fields.push({
                    key: "servers-note",
                    label: "",
                    type: "note",
                    content: "Configure one or more MCP servers below",
                    required: false,
                  });
                }
              }
            }

            // Helper function to resolve $ref in schema
            const resolveSchemaRef = (refSchema, schema) => {
              if (refSchema.$ref && typeof refSchema.$ref === 'string') {
                // Extract the path from the $ref, e.g., "#/$defs/objects/mcp_server_data"
                const refPath = refSchema.$ref.replace('#/', '').split('/');

                // Navigate through the schema to find the referenced object
                let resolvedSchema = schema;
                for (const pathPart of refPath) {
                  if (resolvedSchema[pathPart]) {
                    resolvedSchema = resolvedSchema[pathPart];
                  } else {
                    console.error(`Could not resolve $ref path part: ${pathPart} in ${refSchema.$ref}`);
                    return refSchema; // Return original if can't resolve
                  }
                }

                console.log(`Resolved $ref ${refSchema.$ref} to:`, resolvedSchema);
                return resolvedSchema;
              }
              return refSchema;
            };

            // Helper function to process additional properties from $defs
            const processAdditionalProperties = (schema) => {
              // Check if schema has $defs section with objects
              if (schema.$defs && schema.$defs.objects) {
                const additionalFields = [];

                // Process each object in $defs.objects
                for (const [objectName, objectSchema] of Object.entries(schema.$defs.objects)) {
                  console.log(`Processing additional properties from $defs.objects.${objectName}`);

                  // Check if the object has properties
                  if (objectSchema.properties) {
                    // Process each property in the object
                    for (const [propName, propSchema] of Object.entries(objectSchema.properties)) {
                      // Skip certain properties that shouldn't be directly editable
                      if (propName === "type" || propName === "$schema") continue;

                      const fieldType = schemaTypeToFieldType(
                        propSchema.type,
                        propSchema.format,
                        propSchema.enum
                      );

                      const field = {
                        key: `${objectName}_${propName}`,
                        label: propSchema.title || `${objectName}: ${propName.charAt(0).toUpperCase() + propName.slice(1).replace(/_/g, ' ')}`,
                        type: fieldType,
                        required: objectSchema.required && objectSchema.required.includes(propName),
                        description: propSchema.description || "",
                        group: objectName, // Add a group to organize fields
                      };

                      // Add options for select fields
                      if (fieldType === "select" && propSchema.enum) {
                        field.options = propSchema.enum;
                      }

                      // Add min/max for number fields
                      if (fieldType === "number") {
                        if (propSchema.minimum !== undefined) field.min = propSchema.minimum.toString();
                        if (propSchema.maximum !== undefined) field.max = propSchema.maximum.toString();
                        if (propSchema.multipleOf !== undefined) field.step = propSchema.multipleOf.toString();
                      }

                      additionalFields.push(field);
                    }
                  }
                }

                return additionalFields;
              }

              return [];
            };

            // Process each property in the schema
            for (const [propName, propSchema] of Object.entries(schema.properties)) {
              // Skip certain properties that shouldn't be directly editable
              if (propName === "type" || propName === "$schema") continue;

              // Resolve $ref if present
              const resolvedSchema = propSchema.$ref ? resolveSchemaRef(propSchema, schema) : propSchema;

              const fieldType = schemaTypeToFieldType(
                resolvedSchema.type,
                resolvedSchema.format,
                resolvedSchema.enum
              );

              const field = {
                key: propName,
                label: resolvedSchema.title || propName.charAt(0).toUpperCase() + propName.slice(1).replace(/_/g, ' '),
                type: fieldType,
                required: schema.required && schema.required.includes(propName),
                description: resolvedSchema.description || "",
              };

              // Add options for select fields
              if (fieldType === "select") {
                if (resolvedSchema.enum) {
                  field.options = resolvedSchema.enum;
                } else if (propSchema.enum) {
                  field.options = propSchema.enum;
                }
              }

              // Add min/max for number fields
              if (fieldType === "number") {
                // Use resolved schema values if available, otherwise fall back to original propSchema
                if (resolvedSchema.minimum !== undefined) field.min = resolvedSchema.minimum.toString();
                else if (propSchema.minimum !== undefined) field.min = propSchema.minimum.toString();

                if (resolvedSchema.maximum !== undefined) field.max = resolvedSchema.maximum.toString();
                else if (propSchema.maximum !== undefined) field.max = propSchema.maximum.toString();

                if (resolvedSchema.multipleOf !== undefined) field.step = resolvedSchema.multipleOf.toString();
                else if (propSchema.multipleOf !== undefined) field.step = propSchema.multipleOf.toString();
              }

              // Add placeholder from example if available
              if (example && example[propName] !== undefined) {
                const exampleValue = example[propName];
                if (typeof exampleValue === 'string' || typeof exampleValue === 'number') {
                  field.placeholder = exampleValue.toString();
                }
              }

              fields.push(field);
            }

            // Preserve any custom fields that might exist in the current config
            const customFields = extensionConfigs[feature].fields.filter(field =>
              !fields.some(newField => newField.key === field.key) &&
              ['h4-header', 'skills-list', 'oasf-skills-list', 'locators-list'].includes(field.type)
            );

            // Update the fields, preserving custom fields
            extensionConfigs[feature].fields = [...fields, ...customFields];

            console.log(`Updated ${fields.length} fields for ${feature}`);
          }
        }

        return version; // Return the version for confirmation
      };

      // Extension configurations
      // Create a new extensionConfigs object with the desired order (MCP as second)
      // We'll create a temporary object and then copy properties in the desired order
      const tempExtensionConfigs = {};

      // Step 1: Create extensionConfigs with A2A first
      const extensionConfigs = {
        a2a: {
          name: "A2A Card",
          icon: "🔗",
          iconClass: "a2a-icon",
          description: "Agent-to-Agent communication protocol card",
          schemaName: "schema.oasf.agntcy.org/features/runtime/a2a",
          alternateSchemas: [
            "schema.oasf.outshift.com/features/a2a",
            "schema.oasf.outshift.com/schema/a2a",
            "schema.oasf.agntcy.org/0.5.0/features/a2a",
            "schema.oasf.outshift.com/0.5.0/features/a2a"
          ],
          fields: [
            {
              key: "a2a-card-loader",
              label: "",
              type: "a2a-card-loader",
              required: false,
            },
            {
              key: "name",
              label: "A2A Agent Name",
              type: "text",
              required: true,
            },
            {
              key: "description",
              label: "Description",
              type: "text",
              required: true,
            },
            {
              key: "version",
              label: "Version",
              type: "text",
              required: true,
            },
            // A2A specific fields
            {
              key: "capabilities_pushNotifications",
              label: "Push Notifications",
              type: "checkbox",
              required: false,
            },
            {
              key: "capabilities_streaming",
              label: "Streaming",
              type: "checkbox",
              required: false,
            },
            {
              key: "defaultInputModes",
              label: "Default Input Modes",
              type: "dynamic-list",
              required: false,
            },
            {
              key: "defaultOutputModes",
              label: "Default Output Modes",
              type: "dynamic-list",
              required: false,
            },
            {
              key: "protocolVersion",
              label: "Protocol Version",
              type: "text",
              required: false,
            },
            {
              key: "url",
              label: "URL",
              type: "text",
              required: false,
            },
            {
              key: "skills-header",
              label: "",
              type: "h4-header",
              content: "A2A Skills",
              required: false,
            },
            {
              key: "skills",
              label: "",
              type: "skills-list",
              required: false,
            }
          ],
        },
        mcp: {
          name: "MCP",
          icon: "🔌",
          iconClass: "mcp-icon",
          description: "Model Context Protocol server configuration",
          schemaName: "schema.oasf.outshift.com/features/runtime/mcp",
          alternateSchemas: [
            "schema.oasf.outshift.com/schema/mcp",
            "schema.oasf.agntcy.org/features/runtime/mcp",
            "schema.oasf.agntcy.org/features/mcp"
          ],
          dynamicSchema: true, // Flag to indicate this extension should use dynamic schema fetching
          // Initial fields that will be replaced by dynamic schema
          fields: [
            {
              key: "servers-header",
              label: "",
              type: "h4-header",
              content: "MCP Servers",
              required: false,
            },
            {
              key: "servers",
              label: "",
              type: "servers-list",
              required: false,
            },
            // {
            //   key: "tools-header",
            //   label: "",
            //   type: "h4-header",
            //   content: "MCP Tools",
            //   required: false,
            // },
            // {
            //   key: "tools",
            //   label: "",
            //   type: "tools-list",
            //   required: false,
            // },
            // {
            //   key: "prompts-header",
            //   label: "",
            //   type: "h4-header",
            //   content: "MCP Prompts",
            //   required: false,
            // },
            // {
            //   key: "prompts",
            //   label: "",
            //   type: "prompts-list",
            //   required: false,
            // },
            // {
            //   key: "resources-header",
            //   label: "",
            //   type: "h4-header",
            //   content: "MCP Resources",
            //   required: false,
            // },
            // {
            //   key: "resources",
            //   label: "",
            //   type: "resources-list",
            //   required: false,
            // },
            // {
            //   key: "env_vars",
            //   label: "Environment Variables",
            //   type: "keyvalue",
            //   placeholder: "KEY=value",
            // },
          ],
        },
        model: {
          name: "Model",
          icon: "🤖",
          iconClass: "model-icon",
          description: "AI model configuration",
          schemaName: "schema.oasf.agntcy.org/features/model",
          alternateSchemas: [
            "schema.oasf.outshift.com/features/model",
            "schema.oasf.outshift.com/schema/model",
            "schema.oasf.agntcy.org/0.5.0/features/model",
            "schema.oasf.outshift.com/0.5.0/features/model"
          ],
          fields: [
            {
              key: "provider",
              label: "Provider",
              type: "select",
              options: [
                "OpenAI",
                "Anthropic",
                "Google",
                "Azure",
                "AWS",
                "Other",
              ],
              required: true,
            },
            {
              key: "model_name",
              label: "Model Name",
              type: "text",
              required: true,
              placeholder: "gpt-4",
            },
            {
              key: "api_base",
              label: "API Base URL",
              type: "url",
              required: true,
              placeholder: "https://api.openai.com/v1",
            },
            {
              key: "api_key",
              label: "API Key",
              type: "password",
              required: true,
              placeholder: "sk-...",
            },
            {
              key: "max_tokens",
              label: "Max Tokens",
              type: "number",
              placeholder: "4096",
            },
            {
              key: "temperature",
              label: "Temperature",
              type: "number",
              step: "0.1",
              min: "0",
              max: "2",
              placeholder: "0.7",
            },
          ],
        },
        prompt: {
          name: "LLM Prompt",
          icon: "💬",
          iconClass: "prompt-icon",
          description: "Predefined prompts for agent interactions",
          schemaName: "schema.oasf.agntcy.org/features/prompt",
          alternateSchemas: [
            "schema.oasf.outshift.com/features/prompt",
            "schema.oasf.outshift.com/schema/prompt",
            "schema.oasf.agntcy.org/0.5.0/features/prompt",
            "schema.oasf.outshift.com/0.5.0/features/prompt"
          ],
          fields: [
            {
              key: "prompt_name",
              label: "Prompt Name",
              type: "text",
              required: true,
              placeholder: "system_prompt",
            },
            {
              key: "description",
              label: "Description",
              type: "text",
              required: true,
              placeholder: "Main system prompt for the agent",
            },
            {
              key: "prompt_text",
              label: "Prompt Text",
              type: "textarea",
              required: true,
              placeholder: "You are a helpful assistant...",
            },
            {
              key: "variables",
              label: "Variables",
              type: "keyvalue",
              placeholder: "variable_name=default_value",
            },
          ],
        },
        observability: {
          name: "Observability",
          icon: "📊",
          iconClass: "observability-icon",
          description: "Monitoring and observability configuration",
          schemaName: "schema.oasf.agntcy.org/features/observability",
          alternateSchemas: [
            "schema.oasf.outshift.com/features/observability",
            "schema.oasf.outshift.com/schema/observability",
            "schema.oasf.agntcy.org/0.5.0/features/observability",
            "schema.oasf.outshift.com/0.5.0/features/observability"
          ],
          fields: [
            {
              key: "protocols",
              label: "Communication Protocols",
              type: "multiselect",
              options: ["Otel_OTP_v1", "HTTP_1.1", "gRPC", "SLIM"],
              required: true,
            },
            {
              key: "export_format",
              label: "Export Format",
              type: "select",
              options: ["json", "xml", "csv"],
              required: true,
            },
            {
              key: "data_platforms",
              label: "Data Platform Integrations",
              type: "tags",
              placeholder: "splunk, prometheus, grafana, datadog",
            },
            {
              key: "schema_name",
              label: "Data Schema Name",
              type: "text",
              placeholder: "agntcy-observability-v1",
            },
            {
              key: "schema_url",
              label: "Data Schema URL",
              type: "url",
              placeholder: "https://schema.example.com/observability/v1",
            },
          ],
        },
        evaluation: {
          name: "Evaluation",
          icon: "🏁",
          iconClass: "evaluation-icon",
          description: "Agent evaluation and testing framework",
          schemaName: "schema.oasf.agntcy.org/features/evaluation",
          alternateSchemas: [
            "schema.oasf.outshift.com/features/evaluation",
            "schema.oasf.outshift.com/schema/evaluation",
            "schema.oasf.agntcy.org/0.5.0/features/evaluation",
            "schema.oasf.outshift.com/0.5.0/features/evaluation"
          ],
          fields: [
            {
              key: "evaluation_type",
              label: "Evaluation Type",
              type: "select",
              options: ["performance", "accuracy", "safety", "custom"],
              required: true,
            },
            {
              key: "metrics",
              label: "Metrics to Track",
              type: "multiselect",
              options: [
                "response_time",
                "accuracy_score",
                "hallucination_rate",
                "user_satisfaction",
              ],
              required: true,
            },
            {
              key: "test_dataset",
              label: "Test Dataset URL",
              type: "url",
              placeholder: "https://example.com/test-data.json",
            },
            {
              key: "evaluation_frequency",
              label: "Evaluation Frequency",
              type: "select",
              options: ["on_demand", "hourly", "daily", "weekly"],
              required: true,
            },
            {
              key: "thresholds",
              label: "Performance Thresholds",
              type: "keyvalue",
              placeholder: "accuracy=0.95",
            },
          ],
        },
        custom: {
          name: "Custom Extension",
          icon: "🧩",
          iconClass: "custom-icon",
          description: "Add custom JSON directly to the OASF record",
          schemaName: "custom",
          fields: [
            {
              key: "schema",
              label: "Schema URI",
              type: "text",
              required: true,
              placeholder: "schema.oasf.outshift.com/features/custom",
            },
            {
              key: "json-input",
              label: "Custom JSON",
              type: "json-textarea",
              required: true,
              placeholder: '{"key": "value"}',
            },
          ],
        },
      };
      // Theme Toggle Component
      function ThemeToggle() {
        const [isDark, setIsDark] = useState(() => {
          if (typeof window !== "undefined") {
            // If theme is explicitly set in localStorage, use that
            if (localStorage.getItem("theme")) {
              return localStorage.getItem("theme") === "dark";
            }
            // Otherwise default to dark mode
            return true;
          }
          // Default to dark mode
          return true;
        });
        useEffect(() => {
          const body = document.body;
          if (isDark) {
            body.setAttribute("data-theme", "dark");
            localStorage.setItem("theme", "dark");
          } else {
            body.setAttribute("data-theme", "light");
            localStorage.setItem("theme", "light");
          }
        }, [isDark]);
        return (
          <button
            className="theme-toggle btn btn-ghost"
            onClick={() => setIsDark(!isDark)}
            style={{
              width: "40px",
              height: "40px",
              borderRadius: "8px",
              fontSize: "18px",
            }}
          >
            {isDark ? "☀️" : "🌙"}
          </button>
        );
      }

      function Toast({ message, type = "success", onClose }) {
        const [show, setShow] = useState(false);

        useEffect(() => {
          const showTimer = setTimeout(() => setShow(true), 100);

          const hideTimer = setTimeout(() => {
            setShow(false);
            setTimeout(onClose, 300);
          }, 3000);

          return () => {
            clearTimeout(showTimer);
            clearTimeout(hideTimer);
          };
        }, [onClose]);

        const handleClose = () => {
          setShow(false);
          setTimeout(onClose, 300);
        };

        return (
          <div className={`toast ${type} ${show ? "show" : ""}`}>
            <span>{message}</span>
            <button
              className="toast-close-button"
              onClick={handleClose}
              aria-label="Close notification"
            >
              ×
            </button>
          </div>
        );
      }

      // Confirmation Dialog Component
      function ConfirmDialog({ isOpen, onConfirm, onCancel, title, message }) {
        const [isDarkMode, setIsDarkMode] = React.useState(false);

        // Check for dark mode on mount and when theme changes
        React.useEffect(() => {
          const checkDarkMode = () => {
            const isDark = document.documentElement.classList.contains('dark');
            setIsDarkMode(isDark);
          };

          // Check immediately
          checkDarkMode();

          // Set up an observer to watch for class changes on html element
          const observer = new MutationObserver(checkDarkMode);
          observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });

          return () => observer.disconnect();
        }, []);

        if (!isOpen) return null;

        // Define overlay style based on current dark mode state
        const overlayStyle = {
          position: 'fixed',
          top: 0,
          right: 0,
          bottom: 0,
          left: 0,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 50,
          backgroundColor: isDarkMode ? 'rgba(0, 0, 0, 0.8)' : 'rgba(0, 0, 0, 0.5)'
        };

        return (
          <div style={overlayStyle}>
            <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 max-w-md w-full">
              <h3 className="text-lg font-semibold mb-2 text-red-600 dark:text-red-400">{title}</h3>
              <p className="text-gray-600 dark:text-gray-300 mb-4">{message}</p>
              <div className="flex justify-end space-x-2">
                <button
                  className="btn btn-cancel"
                  onClick={onCancel}
                >
                  Cancel
                </button>
                <button
                  className="btn btn-primary"
                  onClick={onConfirm}
                >
                  Confirm
                </button>
              </div>
            </div>
          </div>
        );
      }

      function ToastContainer({ toasts, removeToast }) {
        return (
          <div className="toast-container">
            {toasts.map((toast) => (
              <Toast
                key={toast.id}
                message={toast.message}
                type={toast.type}
                onClose={() => removeToast(toast.id)}
              />
            ))}
          </div>
        );
      }

      // Loading Spinner Component
      function LoadingSpinner({ size = "medium" }) {
        const sizeClass = {
          small: "w-4 h-4",
          medium: "w-8 h-8",
          large: "w-12 h-12"
        }[size];

        return (
          <div className={`spinner ${sizeClass} border-4 border-t-4 border-gray-200 border-t-primary rounded-full animate-spin`}></div>
        );
      }

      // Extension Gallery Component
      function ExtensionGallery({ extensions, onAddExtension, isLoading }) {
        if (isLoading) {
        return (
            <div className="flex items-center justify-center p-8">
              <div className="text-center">
                <LoadingSpinner size="large" />
                <p className="mt-4 text-muted-foreground">Loading latest OASF schemas...</p>
              </div>
            </div>
          );
        }

        return (
          <div className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2">
            {extensions.map((extension) => (
              <div
                key={extension.id}
                className="extension-tile card p-2 cursor-pointer"
                onClick={() => onAddExtension(extension.id)}
              >
                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white mb-2 ${extension.iconClass || 'bg-primary'}`}>
                  {extension.icon}
                </div>
                <h3 className="font-semibold text-sm mb-1">{extension.name}</h3>
                <p className="text-xs text-muted-foreground line-clamp-2">{extension.description}</p>
              </div>
            ))}
          </div>
        );
      }

      // JSON Textarea Component
      function JsonTextarea({ value, onChange, placeholder }) {
        const [jsonText, setJsonText] = useState(value ? JSON.stringify(value, null, 2) : "");
        const [error, setError] = useState("");

        const handleChange = (e) => {
          const text = e.target.value;
          setJsonText(text);

          try {
            if (text.trim() === "") {
              onChange({});
              setError("");
              return;
            }

            const parsed = JSON.parse(text);
            onChange(parsed);
            setError("");
          } catch (err) {
            setError("Invalid JSON: " + err.message);
          }
        };

        const formatJson = () => {
          try {
            if (jsonText.trim() === "") return;

            const parsed = JSON.parse(jsonText);
            setJsonText(JSON.stringify(parsed, null, 2));
            onChange(parsed);
            setError("");
          } catch (err) {
            setError("Invalid JSON: " + err.message);
          }
        };

        return (
          <div className="w-full">
            <div className="flex justify-between mb-2">
              <div className="flex-grow"></div>
              <button
                type="button"
                className="btn btn-ghost btn-small"
                onClick={formatJson}
                title="Format JSON"
              >
                Format JSON
              </button>
            </div>
            <textarea
              className={`w-full h-64 p-4 font-mono text-sm border rounded-md ${error ? 'border-red-500' : 'border-gray-300'}`}
              value={jsonText}
              onChange={handleChange}
              placeholder={placeholder}
              style={{ resize: "vertical" }}
            />
            {error && <p className="text-red-500 text-sm mt-1">{error}</p>}
          </div>
        );
      }

      // Dynamic List Field Component
      function DynamicListField({ value, onChange, placeholder }) {
        const items = Array.isArray(value) ? value : [""];

        const handleItemChange = (index, newValue) => {
          const newItems = [...items];
          newItems[index] = newValue;
          onChange(newItems);
        };

        const addItem = () => {
          onChange([...items, ""]);
        };

        const removeItem = (index) => {
          if (items.length > 1) {
            const newItems = items.filter((_, i) => i !== index);
            onChange(newItems);
          }
        };

        return (
          <div className="space-y-2">
            {items.map((item, index) => (
              <div key={index} className="flex gap-2 items-center">
                <input
                  className="input flex-1"
                  type="text"
                  value={item}
                  onChange={(e) => handleItemChange(index, e.target.value)}
                  placeholder={placeholder}
                />
                <button
                  type="button"
                  className="btn-danger btn-small"
                  onClick={() => removeItem(index)}
                  disabled={items.length <= 1}
                >
                  ×
                </button>
              </div>
            ))}
            <button
              type="button"
              className="btn btn-secondary btn-small"
              onClick={addItem}
            >
              + Add Item
            </button>
          </div>
        );
      }

      // Extension Skills List Component
      function ExtensionSkillsList({ value, onChange }) {
        const skills = Array.isArray(value)
          ? value
          : [{ id: "", name: "", description: "", examples: [""], tags: [""] }];

        const updateSkill = (index, field, newValue) => {
          const newSkills = [...skills];
          newSkills[index] = { ...newSkills[index], [field]: newValue };
          onChange(newSkills);
        };

        const addSkill = () => {
          onChange([
            ...skills,
            { id: "", name: "", description: "", examples: [""], tags: [""] },
          ]);
        };

        const removeSkill = (index) => {
          if (skills.length > 1) {
            onChange(skills.filter((_, i) => i !== index));
          }
        };

        return (
          <div className="space-y-4">
            {skills.map((skill, index) => (
              <div
                key={index}
                className="border border-border-color rounded-lg p-4"
              >
                <div className="flex justify-between items-center mb-3">
                  <h5 className="font-medium">Skill #{index + 1}</h5>
                  <button
                    type="button"
                    className="btn-danger btn-small"
                    onClick={() => removeSkill(index)}
                    disabled={skills.length <= 1}
                  >
                    Remove
                  </button>
                </div>
                <div className="space-y-3">
                  <div>
                    <label className="label">ID</label>
                    <input
                      className="input"
                      type="text"
                      value={skill.id}
                      onChange={(e) => updateSkill(index, "id", e.target.value)}
                      placeholder="skill_id"
                    />
                  </div>
                  <div>
                    <label className="label">Name</label>
                    <input
                      className="input"
                      type="text"
                      value={skill.name}
                      onChange={(e) =>
                        updateSkill(index, "name", e.target.value)
                      }
                      placeholder="Skill Name"
                    />
                  </div>
                  <div>
                    <label className="label">Description</label>
                    <textarea
                      className="textarea"
                      value={skill.description}
                      onChange={(e) =>
                        updateSkill(index, "description", e.target.value)
                      }
                      placeholder="Skill description..."
                    />
                  </div>
                  <div>
                    <label className="label">Examples</label>
                    <DynamicListField
                      value={skill.examples}
                      onChange={(newValue) =>
                        updateSkill(index, "examples", newValue)
                      }
                      placeholder="Usage example"
                    />
                  </div>
                  <div>
                    <label className="label">Tags</label>
                    <DynamicListField
                      value={skill.tags}
                      onChange={(newValue) =>
                        updateSkill(index, "tags", newValue)
                      }
                      placeholder="tag"
                    />
                  </div>
                </div>
              </div>
            ))}
            <button
              type="button"
              className="btn btn-blue"
              onClick={addSkill}
            >
              + Add Skill
            </button>
          </div>
        );
      }

      // OASF Skills List Component
      function OasfSkillsList({ value, onChange }) {
        const skills = Array.isArray(value)
          ? value
          : [
              {
                class_uid: 10101,
                category_uid: 1,
                category_name: "Natural Language Processing",
                class_name: "Contextual Comprehension",
              },
            ];

        const updateSkill = (index, field, newValue) => {
          const newSkills = [...skills];
          newSkills[index] = { ...newSkills[index], [field]: newValue };
          onChange(newSkills);
        };

        const addSkill = () => {
          onChange([
            ...skills,
            {
              class_uid: 10101,
              category_uid: 1,
              category_name: "",
              class_name: "",
            },
          ]);
        };

        const removeSkill = (index) => {
          if (skills.length > 1) {
            onChange(skills.filter((_, i) => i !== index));
          }
        };

        return (
          <div className="space-y-4">
            {skills.map((skill, index) => (
              <div
                key={index}
                className="border border-border-color rounded-lg p-4"
              >
                <div className="flex justify-between items-center mb-3">
                  <h5 className="font-medium">OASF Skill #{index + 1}</h5>
                  <button
                    type="button"
                    className="btn-danger btn-small"
                    onClick={() => removeSkill(index)}
                    disabled={skills.length <= 1}
                  >
                    Remove
                  </button>
                </div>
                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="label">Class UID</label>
                    <input
                      className="input"
                      type="number"
                      value={skill.class_uid}
                      onChange={(e) =>
                        updateSkill(
                          index,
                          "class_uid",
                          parseInt(e.target.value) || 0
                        )
                      }
                    />
                  </div>
                  <div>
                    <label className="label">Category UID</label>
                    <input
                      className="input"
                      type="number"
                      value={skill.category_uid}
                      onChange={(e) =>
                        updateSkill(
                          index,
                          "category_uid",
                          parseInt(e.target.value) || 0
                        )
                      }
                    />
                  </div>
                  <div>
                    <label className="label">Category Name</label>
                    <input
                      className="input"
                      type="text"
                      value={skill.category_name}
                      onChange={(e) =>
                        updateSkill(index, "category_name", e.target.value)
                      }
                      placeholder="e.g. Natural Language Processing"
                    />
                  </div>
                  <div>
                    <label className="label">Class Name</label>
                    <input
                      className="input"
                      type="text"
                      value={skill.class_name}
                      onChange={(e) =>
                        updateSkill(index, "class_name", e.target.value)
                      }
                      placeholder="e.g. Contextual Comprehension"
                    />
                  </div>
                </div>
              </div>
            ))}
            <button
              type="button"
              className="btn btn-primary"
              onClick={addSkill}
            >
              + Add OASF Skill
            </button>
          </div>
        );
      }

      // Locators List Component
      function LocatorsList({ value, onChange }) {
        const locators = Array.isArray(value)
          ? value
          : [{ type: "source_code", url: "https://github.com/" }];

        const updateLocator = (index, field, newValue) => {
          const newLocators = [...locators];
          newLocators[index] = { ...newLocators[index], [field]: newValue };
          onChange(newLocators);
        };

        const addLocator = () => {
          onChange([...locators, { type: "source_code", url: "" }]);
        };

        const removeLocator = (index) => {
          if (locators.length > 1) {
            onChange(locators.filter((_, i) => i !== index));
          }
        };

        const locatorTypes = [
          "source_code",
          "documentation",
          "api",
          "demo",
          "other",
        ];

        return (
          <div className="space-y-4">
            {locators.map((locator, index) => (
              <div
                key={index}
                className="border border-border-color rounded-lg p-4"
              >
                <div className="flex justify-between items-center mb-3">
                  <h5 className="font-medium">Locator #{index + 1}</h5>
                  <button
                    type="button"
                    className="btn-danger btn-small"
                    onClick={() => removeLocator(index)}
                    disabled={locators.length <= 1}
                  >
                    Remove
                  </button>
                </div>
                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="label">Type</label>
                    <select
                      className="select"
                      value={locator.type}
                      onChange={(e) =>
                        updateLocator(index, "type", e.target.value)
                      }
                    >
                      {locatorTypes.map((type) => (
                        <option key={type} value={type}>
                          {type}
                        </option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className="label">URL</label>
                    <input
                      className="input"
                      type="url"
                      value={locator.url}
                      onChange={(e) =>
                        updateLocator(index, "url", e.target.value)
                      }
                      placeholder="https://..."
                    />
                  </div>
                </div>
              </div>
            ))}
            <button
              type="button"
              className="btn btn-primary btn-small"
              onClick={addLocator}
            >
              + Add Locator
            </button>
          </div>
        );
      }

      // A2A Card Loader Component
      function A2ACardLoader({ onLoadCard }) {
        const [cardUrl, setCardUrl] = useState("");
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState("");

        // Fetch card data from URL
        const fetchCardFromUrl = async (url) => {
          try {
            setLoading(true);
            setError("");

            // First, check if the URL is HTTP or HTTPS
            const isHttp = url.startsWith("http://");
            let fetchUrl = url;

            // Try to fetch with CORS handling
            try {
              // First try with the original URL
              let response = await fetch(fetchUrl, {
                headers: {
                  Accept: "application/json",
                },
                mode: "cors",
              });

              // If the original URL fails and it's HTTP, try with HTTPS
              if (!response.ok && isHttp) {
                console.log("HTTP URL failed, trying with HTTPS...");
                fetchUrl = url.replace("http://", "https://");
                response = await fetch(fetchUrl, {
                  headers: {
                    Accept: "application/json",
                  },
                  mode: "cors",
                });
              }

              if (response.ok) {
                const data = await response.json();
                return data;
              } else {
                console.warn(
                  `Failed to fetch from ${fetchUrl}: ${response.status} ${response.statusText}`
                );
              }
            } catch (corsError) {
              console.warn(`CORS/network error with ${fetchUrl}:`, corsError);
              // If we tried HTTPS already, show a more helpful error message
              if (fetchUrl.startsWith("https://")) {
                setError(
                  `Could not load data from ${url}. If this is a local development server, make sure it is running on https or copy the JSON data here.`
                );
              } else if (isHttp) {
                setError(
                  `Could not load data from ${url}. If this is a local development server, make sure it is running on https or copy the JSON data here.`
                );
              } else {
                setError(
                  `Could not load data from ${url}. Please check the URL and try again.`
                );
              }
              // Continue to fallback
            }

            // If we reach here, either the fetch failed or CORS blocked it
            // For demo purposes, return example data based on the URL
            if (url.includes("localhost") || url.includes("agent.json")) {
              return {
                name: "Sample A2A Card",
                version: "0.1.0",
                description: "Sample A2A card description",
                capabilities: {
                  pushNotifications: true,
                  streaming: true,
                },
                defaultInputModes: ["text", "text/plain"],
                defaultOutputModes: ["text", "text/plain"],
                protocolVersion: "0.2.6",
                url: "http://localhost:8000/",
                authors: ["Sample Author"],
                skills: [
                  {
                    description:
                      "An AI Platform Engineer is a multi-agent system designed to manage operations across various tools.",
                    examples: [
                      "Create a new ArgoCD application named 'my-app'.",
                      "Get the status of the 'frontend' ArgoCD application.",
                      "Update the image version for 'backend' app.",
                    ],
                    id: "ai_platform_engineer",
                    name: "AI Platform Engineer",
                    tags: ["github", "devops"],
                  },
                ],
                locators: [
                  {
                    type: "source_code",
                    url: "https://github.com/",
                  },
                ],
              };
            } else {
              throw new Error(
                `Could not fetch A2A card from ${url}. CORS may be blocking the request.`
              );
            }
          } catch (error) {
            console.error("Error fetching card data:", error);
            if (url.includes("localhost") || url.includes("127.0.0.1")) {
              setError(
                `Could not load data from ${url}. If this is a local development server, make sure it is running on https or copy the JSON data here.`
              );
            } else {
              setError(`Failed to load data: ${error.message}`);
            }
            return null;
          } finally {
            setLoading(false);
          }
        };

        // Load A2A card data and populate form
        const loadCardData = async () => {
          if (!cardUrl.trim()) {
            setError("Please enter a valid URL or JSON data");
            return;
          }

          let cardData;
          const input = cardUrl.trim();

          // Check if input is JSON data
          if (input.startsWith("{") && input.endsWith("}")) {
            try {
              setLoading(true);
              setError("");
              cardData = JSON.parse(input);
            } catch (error) {
              console.error("Error parsing JSON:", error);
              setError(`Invalid JSON data: ${error.message}`);
              setLoading(false);
              return;
            }
          } else {
            // Input is a URL
            cardData = await fetchCardFromUrl(input);
          }

          if (cardData) {
            // Prepare the form data object to populate all A2A fields
            const formData = {};

            // Basic fields
            formData.name = cardData.name || "";
            formData.description = cardData.description || "";
            formData.version = cardData.version || "";
            formData.url = cardData.url || "";
            formData.protocolVersion = cardData.protocolVersion || "";

            // Input/Output modes
            if (
              cardData.defaultInputModes &&
              Array.isArray(cardData.defaultInputModes)
            ) {
              formData.defaultInputModes =
                cardData.defaultInputModes.length > 0
                  ? cardData.defaultInputModes
                  : ["text"];
            } else {
              formData.defaultInputModes = ["text"];
            }

            if (
              cardData.defaultOutputModes &&
              Array.isArray(cardData.defaultOutputModes)
            ) {
              formData.defaultOutputModes =
                cardData.defaultOutputModes.length > 0
                  ? cardData.defaultOutputModes
                  : ["text"];
            } else {
              formData.defaultOutputModes = ["text"];
            }

            // Capabilities
            if (cardData.capabilities) {
              formData.capabilities = {
                pushNotifications: !!cardData.capabilities.pushNotifications,
                streaming: !!cardData.capabilities.streaming,
              };
            }

            // Skills
            if (cardData.skills && Array.isArray(cardData.skills)) {
              formData["skills"] = cardData.skills.map((skill) => ({
                id: skill.id || "",
                name: skill.name || "",
                description: skill.description || "",
                examples: skill.examples || [""],
                tags: skill.tags || [""],
              }));
            }

            // OASF Skills
            if (cardData.oasfSkills && Array.isArray(cardData.oasfSkills)) {
              formData["oasf-skills"] = cardData.oasfSkills;
            }

            // Locators
            if (cardData.locators && Array.isArray(cardData.locators)) {
              formData.locators = cardData.locators;
            }

            // Call onLoadCard with all the form data at once
            onLoadCard(formData);

            // Show success toast notification
            addToast("A2A Card imported successfully", "success");

            setLoading(false);
            setError("");
          }
        };

        const handlePaste = (e) => {
          const pastedText = e.clipboardData.getData("text");

          // Check if it looks like JSON but isn't properly formatted
          if (pastedText.includes("{") && pastedText.includes("}")) {
            try {
              // Try to parse and format the JSON
              const jsonObj = JSON.parse(pastedText);
              const formattedJson = JSON.stringify(jsonObj, null, 2);

              // Prevent default paste and use formatted JSON
              e.preventDefault();
              setCardUrl(formattedJson);

              // Dynamically adjust the height based on content
              setTimeout(() => {
                const lines = formattedJson.split("\n").length;
                const newHeight = Math.min(Math.max(lines * 20, 100), 400);
                const textarea = e.target;
                textarea.style.height = `${newHeight}px`;
              }, 0);
            } catch (error) {
              // If it's not valid JSON, just let the default paste happen
              console.warn("Pasted content is not valid JSON:", error);
            }
          }
        };

        return (
          <div className="url-input-container">
            <div className="example-link">
              <span>Example: </span>
              <a
                href="#"
                onClick={(e) => {
                  e.preventDefault();
                  setCardUrl(
                    "https://raw.githubusercontent.com/sriaradhyula/generate-agntcy-oasf-card/refs/heads/main/.well-known/agent.json"
                  );
                }}
              >
                https://raw.githubusercontent.com/sriaradhyula/generate-agntcy-oasf-card/refs/heads/main/.well-known/agent.json
              </a>
            </div>
            <textarea
              className="url-input"
              placeholder="Enter A2A card URL (e.g. https://localhost:8000/.well-known/agent.json) or JSON data"
              value={cardUrl}
              onChange={(e) => setCardUrl(e.target.value)}
              onPaste={handlePaste}
              rows={4}
              spellCheck={false}
            />
            <button
              className="url-button"
              onClick={loadCardData}
              disabled={loading || !cardUrl.trim()}
            >
              <div className="url-button-content">
                {loading ? (
                  <>
                    <div
                      className="loading-spinner"
                      style={{
                        width: "16px",
                        height: "16px",
                        marginRight: "8px",
                      }}
                    />
                    Loading...
                  </>
                ) : (
                  "🔃 Load A2A Card"
                )}
              </div>
            </button>
            {error && (
              <div
                style={{
                  marginTop: "12px",
                  padding: "12px",
                  backgroundColor: "var(--destructive-light, #fef2f2)",
                  color: "var(--destructive, #dc2626)",
                  border: "1px solid var(--destructive-light, #fecaca)",
                  borderRadius: "var(--radius)",
                  fontSize: "0.875rem",
                }}
              >
                {error}
              </div>
            )}
          </div>
        );
      }

      // Form Field Component
      function FormField({ field, value, onChange, error, formData }) {
        const handleChange = (e) => {
          onChange(field.key, e.target.value);
        };
        const handleKeyValueChange = (e) => {
          // Try to parse as JSON first
          try {
            const jsonValue = JSON.parse(e.target.value);
            if (typeof jsonValue === 'object' && jsonValue !== null) {
              onChange(field.key, jsonValue);
              return;
            }
          } catch (err) {
            // Not valid JSON, continue with KEY=value parsing
          }

          // Parse as KEY=value pairs
          const pairs = e.target.value
            .split("\n")
            .filter((line) => line.trim());
          const obj = {};
          pairs.forEach((pair) => {
            const [key, ...valueParts] = pair.split("=");
            if (key && valueParts.length > 0) {
              obj[key.trim()] = valueParts.join("=").trim();
            }
          });
          onChange(field.key, obj);
        };
        const handleTagsChange = (e) => {
          const tags = e.target.value
            .split(",")
            .map((tag) => tag.trim())
            .filter((tag) => tag);
          onChange(field.key, tags);
        };
        const handleMultiSelectChange = (e) => {
          const selectedOptions = Array.from(e.target.selectedOptions).map(
            (option) => option.value
          );
          onChange(field.key, selectedOptions);
        };
        const renderInput = () => {
          switch (field.type) {
            case "checkbox":
              return (
                <input
                  type="checkbox"
                  checked={value || false}
                  onChange={(e) => onChange(field.key, e.target.checked)}
                  className="w-4 h-4"
                />
              );
            case "dynamic-list":
              // This is handled separately in the main field rendering
              return null;
            case "h4-header":
              return (
                <h4
                  style={{
                    marginTop: "24px",
                    marginBottom: "8px",
                    color: "var(--fg)",
                    fontSize: "18px",
                    fontWeight: "bold",
                  }}
                >
                  {field.content === "OASF Skill List"
                    ? [
                        field.content + " (",
                        React.createElement(
                          "a",
                          {
                            href: "https://schema.oasf.outshift.com/",
                            target: "_blank",
                            style: {
                              color: "var(--primary)",
                              textDecoration: "underline",
                              fontSize: "14px",
                              fontWeight: "normal",
                            },
                          },
                          "schema reference"
                        ),
                        ")",
                      ]
                    : field.content}
                </h4>
              );
            case "skills-list":
            case "oasf-skills-list":
            case "locators-list":
            case "tools-list":
            case "prompts-list":
            case "resources-list":
            case "servers-list":
            case "a2a-card-loader":
              // These are handled separately in the main field rendering
              return null;
            case "textarea":
              return (
                <textarea
                  className="textarea"
                  value={value || ""}
                  onChange={handleChange}
                  placeholder={field.placeholder}
                  required={field.required}
                />
              );
            case "select":
              return (
                <select
                  className="select"
                  value={value || ""}
                  onChange={handleChange}
                  required={field.required}
                >
                  <option value="">Select an option</option>
                  {field.options?.map((option) => (
                    <option key={option} value={option}>
                      {option}
                    </option>
                  ))}
                </select>
              );
            case "multiselect":
              return (
                <select
                  className="select"
                  multiple
                  value={value || []}
                  onChange={handleMultiSelectChange}
                  required={field.required}
                  style={{ height: "120px" }}
                >
                  {field.options?.map((option) => (
                    <option key={option} value={option}>
                      {option}
                    </option>
                  ))}
                </select>
              );
            case "keyvalue":
              const kvValue =
                typeof value === "object" && value !== null
                  ? Object.entries(value)
                      .map(([k, v]) => `${k}=${v}`)
                      .join("\n")
                  : "";
              // Use a controlled component with state for better input handling
              const [localValue, setLocalValue] = useState(kvValue);

              // Update local value when the prop value changes
              useEffect(() => {
                setLocalValue(kvValue);
              }, [kvValue]);

              const handleLocalChange = (e) => {
                const newValue = e.target.value;
                setLocalValue(newValue);

                // Debounce the actual onChange to avoid excessive updates
                setTimeout(() => {
                  handleKeyValueChange({
                    target: { value: newValue }
                  });
                }, 100);
              };

              return (
                <textarea
                  className="textarea"
                  value={localValue}
                  onChange={handleLocalChange}
                  onKeyDown={(e) => {
                    // Just stop propagation, don't interfere with default behavior
                    e.stopPropagation();
                  }}
                  placeholder={field.placeholder}
                />
              );
            case "json-textarea":
              return (
                <JsonTextarea
                  value={value}
                  onChange={(val) => onChange(field.key, val)}
                  placeholder={field.placeholder}
                />
              );
            case "tags":
              const tagsValue = Array.isArray(value) ? value.join(", ") : "";
              return (
                <input
                  className="input"
                  type="text"
                  value={tagsValue}
                  onChange={handleTagsChange}
                  placeholder={field.placeholder}
                />
              );
            case "number":
              return (
                <input
                  className="input"
                  type="number"
                  value={value || ""}
                  onChange={handleChange}
                  placeholder={field.placeholder}
                  min={field.min}
                  max={field.max}
                  step={field.step}
                  required={field.required}
                />
              );
            case "password":
              return (
                <input
                  className="input"
                  type="password"
                  value={value || ""}
                  onChange={handleChange}
                  placeholder={field.placeholder}
                  required={field.required}
                />
              );
            case "url":
              return (
                <input
                  className="input"
                  type="url"
                  value={value || ""}
                  onChange={handleChange}
                  placeholder={field.placeholder}
                  required={field.required}
                />
              );
            default:
              return (
                <input
                  className="input"
                  type="text"
                  value={value || ""}
                  onChange={handleChange}
                  placeholder={field.placeholder}
                  required={field.required}
                />
              );
          }
        };
        return (
          <div className="mb-4 p-4">
            {field.type === "h4-header" ? (
              <h4
                style={{
                  marginTop: "24px",
                  marginBottom: "8px",
                  color: "var(--fg)",
                  fontSize: "18px",
                  fontWeight: "bold",
                }}
              >
                {field.content === "OASF Skill List"
                  ? [
                      field.content + " (",
                      React.createElement(
                        "a",
                        {
                          href: "https://schema.oasf.outshift.com/",
                          target: "_blank",
                          style: {
                            color: "var(--primary)",
                            textDecoration: "underline",
                            fontSize: "14px",
                            fontWeight: "normal",
                          },
                        },
                        "schema reference"
                      ),
                      ")",
                    ]
                  : field.content}
              </h4>
            ) : field.type === "dynamic-list" ? (
              <>
                {field.label && (
                  <label className="label mb-2 block">
                    {field.label}
                    {field.required && (
                      <span className="text-destructive ml-1">*</span>
                    )}
                  </label>
                )}
                <div className="dynamic-list-container">
                  {(value || [""]).map((item, index) => (
                    <div key={index} className="dynamic-list-item">
                      <input
                        type="text"
                        value={item}
                        onChange={(e) => {
                          const newList = [...(value || [""])];
                          newList[index] = e.target.value;
                          onChange(field.key, newList);
                        }}
                        onKeyPress={(e) => {
                          if (e.key === "Enter" && !e.shiftKey) {
                            e.preventDefault();
                            const newList = [...(value || [""]), ""];
                            onChange(field.key, newList);
                            // Focus the new input after a short delay
                            setTimeout(() => {
                              const inputs = document.querySelectorAll(
                                `[data-list-type="${
                                  field.key
                                }"][data-list-index="${index + 1}"]`
                              );
                              if (inputs.length > 0) {
                                inputs[0].focus();
                              }
                            }, 10);
                          }
                        }}
                        placeholder={
                          field.key === "authors"
                            ? "Enter author and press Enter for next entry"
                            : field.key === "defaultInputModes"
                            ? "Enter input mode (e.g. text, text/plain)"
                            : field.key === "defaultOutputModes"
                            ? "Enter output mode (e.g. text, text/plain)"
                            : field.placeholder ||
                              "Press Enter to add new entry"
                        }
                        data-list-type={field.key}
                        data-list-index={index}
                        style={{
                          flex: 1,
                          padding: "8px",
                          border: "1px solid var(--border-color, #ccc)",
                          borderRadius: "4px",
                          backgroundColor: "var(--input-bg, #fff)",
                          color: "var(--input-fg, #333)",
                        }}
                      />
                      <button
                        type="button"
                        onClick={() => {
                          if ((value || [""]).length <= 1) return;
                          const newList = (value || [""]).filter(
                            (_, i) => i !== index
                          );
                          onChange(field.key, newList);
                        }}
                        disabled={(value || [""]).length <= 1}
                        style={{
                          marginLeft: "8px",
                          marginBottom: "14px",
                          padding: "4px 8px",
                          backgroundColor: "var(--Brand-Logo-Primary, #187ADC)",
                          color: "white",
                          border: "none",
                          borderRadius: "4px",
                          cursor: "pointer",
                          alignItems: "top",
                          justifyContent: "top",
                          opacity: (value || [""]).length <= 1 ? 0.5 : 1,
                        }}
                      >
                        ×
                      </button>
                    </div>
                  ))}
                  <button
                    type="button"
                    onClick={() => {
                      const newList = [...(value || [""]), ""];
                      onChange(field.key, newList);
                    }}
                    style={{
                      marginTop: "8px",
                      padding: "4px 8px",
                      backgroundColor: "var(--primary)",
                      color: "white",
                      border: "none",
                      borderRadius: "4px",
                      cursor: "pointer",
                    }}
                  >
                    + Add{" "}
                    {field.key === "authors"
                      ? "Author"
                      : field.key === "defaultInputModes"
                      ? "Input Mode"
                      : field.key === "defaultOutputModes"
                      ? "Output Mode"
                      : "Entry"}
                  </button>
                </div>
              </>
            ) : field.type === "servers-list" ? (
              <>
                {field.label && (
                  <label className="label mb-2 block">
                    {field.label}
                    {field.required && (
                      <span className="text-destructive ml-1">*</span>
                    )}
                  </label>
                )}
                <div
                  style={{
                    backgroundColor: "var(--primary-light)",
                    padding: "16px",
                    borderRadius: "var(--radius-lg)",
                    marginBottom: "24px",
                    border: "1px solid var(--border-color)",
                  }}
                >
                  {(
                    value || [
                      {
                        args: [
                          "--directory",
                          "/FULL_PATH/weather/weather_mcp_server",
                          "run",
                          "mcp_server.py"
                        ],
                        name: "mcp-weather",
                        type: "mcp-server",
                        command: "uv",
                        tool_configuration: {
                          tools: [
                            {
                              name: "get-forecast",
                              parameters: [
                                {
                                  name: "latitude",
                                  type: "number",
                                  required: true,
                                  description:
                                    "Latitude of the location (-90 to 90)."
                                },
                                {
                                  name: "longitude",
                                  type: "number",
                                  required: true,
                                  description:
                                    "Longitude of the location (-180 to 180)."
                                }
                              ],
                              description:
                                "Retrieves detailed weather forecast for a specified US location."
                            },
                            {
                              name: "search-data",
                              parameters: [
                                {
                                  name: "query",
                                  type: "string",
                                  required: true,
                                  description: "Search query string."
                                },
                                {
                                  name: "limit",
                                  type: "number",
                                  required: false,
                                  description:
                                    "Maximum number of results to return."
                                }
                              ],
                              description:
                                "Search through available data records."
                            },
                            {
                              name: "get-alerts",
                              parameters: [
                                {
                                  name: "state",
                                  type: "string",
                                  required: true,
                                  description:
                                    "Two-letter US state code (e.g., CA, NY)."
                                }
                              ],
                              description:
                                "Retrieves active weather alerts for a specified US state."
                            }
                          ],
                          prompts: [
                            {
                              name: "help",
                              content:
                                "Type 'help' for a list of available commands and tools, or use the /tools endpoint to discover tool capabilities."
                            },
                            {
                              name: "greeting",
                              content:
                                "Hello! I can help you with weather information and forecasts."
                            },
                            {
                              name: "error",
                              content:
                                "An error occurred while fetching weather data. Please check your input and try again."
                            },
                            {
                              name: "welcome",
                              content:
                                "Welcome to the MCP Weather Server. Use the available tools to get weather forecasts and alerts."
                            }
                          ],
                          resources: [
                            {
                              url: "https://modelcontextprotocol.io/docs/mcp-weather",
                              name: "documentation",
                              description:
                                "Official documentation for the MCP Weather Server."
                            },
                            {
                              url: "https://modelcontextprotocol.io/examples/mcp-weather",
                              name: "examples",
                              description:
                                "Example requests and responses for using the server."
                            },
                            {
                              url: "https://api.0p2lqg.com/docs",
                              name: "api-docs",
                              description: "API documentation and reference."
                            }
                          ]
                        }
                      }
                    ]
                  ).map((server, serverIndex) => (
                    <div key={serverIndex} className="server-container mb-6">
                      <div className="server-header">
                        <h3 style={{ margin: "0", flex: "1" }}>
                          Server {serverIndex + 1}: {server.name || "New Server"}
                        </h3>
                        {(value || []).length > 1 && (
                          <button
                            type="button"
                            onClick={() => {
                              const newList = (value || []).filter(
                                (_, i) => i !== serverIndex
                              );
                              onChange(field.key, newList);
                            }}
                            className="btn btn-danger btn-small"
                          >
                            Remove Server
                          </button>
                        )}
                      </div>
                      <div className="server-fields">
                        <div style={{ marginBottom: "16px" }}>
                          <label className="label mb-2 block">
                            Server Name
                            <span className="text-destructive ml-1">*</span>
                          </label>
                          <input
                            className="input"
                            type="text"
                            value={server.name || ""}
                            onChange={(e) => {
                              const newList = [...(value || [])];
                              newList[serverIndex] = {
                                ...newList[serverIndex],
                                name: e.target.value,
                              };
                              onChange(field.key, newList);
                            }}
                            placeholder="my-mcp-server"
                          />
                        </div>
                        <div style={{ marginBottom: "16px" }}>
                          <label className="label mb-2 block">
                            Server Type
                            <span className="text-destructive ml-1">*</span>
                          </label>
                          <select
                            className="select"
                            value={server.type || "mcp-server"}
                            onChange={(e) => {
                              const newList = [...(value || [])];
                              newList[serverIndex] = {
                                ...newList[serverIndex],
                                type: e.target.value,
                              };
                              onChange(field.key, newList);
                            }}
                          >
                            <option value="http">HTTP</option>
                            <option value="stdio">STDIO</option>
                            <option value="sse">SSE</option>
                          </select>
                        </div>
                        <div style={{ marginBottom: "16px" }}>
                          <label className="label mb-2 block">
                            Command
                          </label>
                          <input
                            className="input"
                            type="text"
                            value={server.command || ""}
                            onChange={(e) => {
                              const newList = [...(value || [])];
                              newList[serverIndex] = {
                                ...newList[serverIndex],
                                command: e.target.value,
                              };
                              onChange(field.key, newList);
                            }}
                            placeholder="python server.py"
                          />
                        </div>

                        {/* Args array */}
                        <div style={{ marginBottom: "16px" }}>
                          <label className="label mb-2 block">Arguments</label>
                          <div className="dynamic-list-container">
                            {(server.args || []).map((arg, argIndex) => (
                              <div key={argIndex} className="dynamic-list-item">
                                <input
                                  className="input"
                                  type="text"
                                  value={arg || ""}
                                  onChange={(e) => {
                                    const newList = [...(value || [])];
                                    const newArgs = [...(newList[serverIndex].args || [])];
                                    newArgs[argIndex] = e.target.value;
                                    newList[serverIndex] = {
                                      ...newList[serverIndex],
                                      args: newArgs,
                                    };
                                    onChange(field.key, newList);
                                  }}
                                  placeholder="--argument"
                                />
                                <button
                                  type="button"
                                  onClick={() => {
                                    const newList = [...(value || [])];
                                    const newArgs = [...(newList[serverIndex].args || [])];
                                    newArgs.splice(argIndex, 1);
                                    newList[serverIndex] = {
                                      ...newList[serverIndex],
                                      args: newArgs,
                                    };
                                    onChange(field.key, newList);
                                  }}
                                  className="btn btn-danger btn-small"
                                  disabled={(server.args || []).length <= 1}
                                >
                                  Remove
                                </button>
                              </div>
                            ))}
                            <button
                              type="button"
                              onClick={() => {
                                const newList = [...(value || [])];
                                const newArgs = [...(newList[serverIndex].args || []), ""];
                                newList[serverIndex] = {
                                  ...newList[serverIndex],
                                  args: newArgs,
                                };
                                onChange(field.key, newList);
                              }}
                              className="btn btn-primary btn-small"
                            >
                              Add Argument
                            </button>
                          </div>
                        </div>
                        {/* Tool Configuration section */}
                        <div style={{ marginTop: "20px", marginBottom: "16px" }}>
                          <h4 style={{ marginBottom: "10px" }}>Tool Configuration</h4>

                          {/* Tools section */}
                          <div style={{ marginBottom: "16px" }}>
                            <h5 style={{ marginBottom: "8px" }}>Tools</h5>
                            <div
                              style={{
                                backgroundColor: "var(--bg)",
                                padding: "12px",
                                borderRadius: "var(--radius)",
                                border: "1px solid var(--border-color)",
                              }}
                            >
                              {((server.tool_configuration || {}).tools || []).map((tool, toolIndex) => (
                                <div key={toolIndex} className="mb-4 pb-4" style={{ borderBottom: toolIndex < ((server.tool_configuration || {}).tools || []).length - 1 ? "1px solid var(--border-color)" : "none" }}>
                                  <div style={{ display: "flex", justifyContent: "space-between", marginBottom: "10px" }}>
                                    <h6 style={{ margin: "0" }}>Tool {toolIndex + 1}: {tool.name || "New Tool"}</h6>
                                    <button
                                      type="button"
                                      onClick={() => {
                                        const newList = [...(value || [])];
                                        const toolConfig = newList[serverIndex].tool_configuration || {};
                                        const tools = [...(toolConfig.tools || [])];
                                        tools.splice(toolIndex, 1);
                                        newList[serverIndex] = {
                                          ...newList[serverIndex],
                                          tool_configuration: {
                                            ...toolConfig,
                                            tools: tools
                                          }
                                        };
                                        onChange(field.key, newList);
                                      }}
                                      className="btn btn-danger btn-small"
                                    >
                                      Remove
                                    </button>
                                  </div>

                                  <div style={{ marginBottom: "8px" }}>
                                    <label className="label mb-1 block">Name</label>
                                    <input
                                      className="input"
                                      type="text"
                                      value={tool.name || ""}
                                      onChange={(e) => {
                                        const newList = [...(value || [])];
                                        const toolConfig = newList[serverIndex].tool_configuration || {};
                                        const tools = [...(toolConfig.tools || [])];
                                        tools[toolIndex] = {
                                          ...tools[toolIndex],
                                          name: e.target.value
                                        };
                                        newList[serverIndex] = {
                                          ...newList[serverIndex],
                                          tool_configuration: {
                                            ...toolConfig,
                                            tools: tools
                                          }
                                        };
                                        onChange(field.key, newList);
                                      }}
                                      placeholder="get-forecast"
                                    />
                                  </div>

                                  <div style={{ marginBottom: "8px" }}>
                                    <label className="label mb-1 block">Description</label>
                                    <textarea
                                      className="textarea"
                                      value={tool.description || ""}
                                      onChange={(e) => {
                                        const newList = [...(value || [])];
                                        const toolConfig = newList[serverIndex].tool_configuration || {};
                                        const tools = [...(toolConfig.tools || [])];
                                        tools[toolIndex] = {
                                          ...tools[toolIndex],
                                          description: e.target.value
                                        };
                                        newList[serverIndex] = {
                                          ...newList[serverIndex],
                                          tool_configuration: {
                                            ...toolConfig,
                                            tools: tools
                                          }
                                        };
                                        onChange(field.key, newList);
                                      }}
                                      placeholder="Tool description"
                                    />
                                  </div>

                                  {/* Parameters section */}
                                  <div style={{ marginTop: "10px" }}>
                                    <label className="label mb-1 block">Parameters</label>
                                    {(tool.parameters || []).map((param, paramIndex) => (
                                      <div
                                        key={paramIndex}
                                        style={{
                                          padding: "8px",
                                          backgroundColor: "var(--primary-light)",
                                          borderRadius: "var(--radius)",
                                          marginBottom: "8px",
                                          border: "1px solid var(--border-color)"
                                        }}
                                      >
                                        <div style={{ display: "flex", justifyContent: "space-between", marginBottom: "8px" }}>
                                          <span style={{ fontWeight: "500" }}>Parameter {paramIndex + 1}</span>
                                          <button
                                            type="button"
                                            onClick={() => {
                                              const newList = [...(value || [])];
                                              const toolConfig = newList[serverIndex].tool_configuration || {};
                                              const tools = [...(toolConfig.tools || [])];
                                              const params = [...(tools[toolIndex].parameters || [])];
                                              params.splice(paramIndex, 1);
                                              tools[toolIndex] = {
                                                ...tools[toolIndex],
                                                parameters: params
                                              };
                                              newList[serverIndex] = {
                                                ...newList[serverIndex],
                                                tool_configuration: {
                                                  ...toolConfig,
                                                  tools: tools
                                                }
                                              };
                                              onChange(field.key, newList);
                                            }}
                                            className="btn btn-small btn-danger"
                                          >
                                            Remove
                                          </button>
                                        </div>

                                        <div style={{ marginBottom: "8px" }}>
                                          <label className="label mb-1 block">Name</label>
                                          <input
                                            className="input"
                                            type="text"
                                            value={param.name || ""}
                                            onChange={(e) => {
                                              const newList = [...(value || [])];
                                              const toolConfig = newList[serverIndex].tool_configuration || {};
                                              const tools = [...(toolConfig.tools || [])];
                                              const params = [...(tools[toolIndex].parameters || [])];
                                              params[paramIndex] = {
                                                ...params[paramIndex],
                                                name: e.target.value
                                              };
                                              tools[toolIndex] = {
                                                ...tools[toolIndex],
                                                parameters: params
                                              };
                                              newList[serverIndex] = {
                                                ...newList[serverIndex],
                                                tool_configuration: {
                                                  ...toolConfig,
                                                  tools: tools
                                                }
                                              };
                                              onChange(field.key, newList);
                                            }}
                                            placeholder="parameter_name"
                                          />
                                        </div>

                                        <div style={{ marginBottom: "8px" }}>
                                          <label className="label mb-1 block">Type</label>
                                          <select
                                            className="select"
                                            value={param.type || "string"}
                                            onChange={(e) => {
                                              const newList = [...(value || [])];
                                              const toolConfig = newList[serverIndex].tool_configuration || {};
                                              const tools = [...(toolConfig.tools || [])];
                                              const params = [...(tools[toolIndex].parameters || [])];
                                              params[paramIndex] = {
                                                ...params[paramIndex],
                                                type: e.target.value
                                              };
                                              tools[toolIndex] = {
                                                ...tools[toolIndex],
                                                parameters: params
                                              };
                                              newList[serverIndex] = {
                                                ...newList[serverIndex],
                                                tool_configuration: {
                                                  ...toolConfig,
                                                  tools: tools
                                                }
                                              };
                                              onChange(field.key, newList);
                                            }}
                                          >
                                            <option value="string">String</option>
                                            <option value="number">Number</option>
                                            <option value="boolean">Boolean</option>
                                            <option value="array">Array</option>
                                            <option value="object">Object</option>
                                          </select>
                                        </div>

                                        <div style={{ marginBottom: "8px" }}>
                                          <label className="label mb-1 block">Required</label>
                                          <input
                                            type="checkbox"
                                            checked={param.required || false}
                                            onChange={(e) => {
                                              const newList = [...(value || [])];
                                              const toolConfig = newList[serverIndex].tool_configuration || {};
                                              const tools = [...(toolConfig.tools || [])];
                                              const params = [...(tools[toolIndex].parameters || [])];
                                              params[paramIndex] = {
                                                ...params[paramIndex],
                                                required: e.target.checked
                                              };
                                              tools[toolIndex] = {
                                                ...tools[toolIndex],
                                                parameters: params
                                              };
                                              newList[serverIndex] = {
                                                ...newList[serverIndex],
                                                tool_configuration: {
                                                  ...toolConfig,
                                                  tools: tools
                                                }
                                              };
                                              onChange(field.key, newList);
                                            }}
                                          />
                                        </div>

                                        <div>
                                          <label className="label mb-1 block">Description</label>
                                          <textarea
                                            className="textarea"
                                            value={param.description || ""}
                                            onChange={(e) => {
                                              const newList = [...(value || [])];
                                              const toolConfig = newList[serverIndex].tool_configuration || {};
                                              const tools = [...(toolConfig.tools || [])];
                                              const params = [...(tools[toolIndex].parameters || [])];
                                              params[paramIndex] = {
                                                ...params[paramIndex],
                                                description: e.target.value
                                              };
                                              tools[toolIndex] = {
                                                ...tools[toolIndex],
                                                parameters: params
                                              };
                                              newList[serverIndex] = {
                                                ...newList[serverIndex],
                                                tool_configuration: {
                                                  ...toolConfig,
                                                  tools: tools
                                                }
                                              };
                                              onChange(field.key, newList);
                                            }}
                                            placeholder="Parameter description"
                                          />
                                        </div>
                                      </div>
                                    ))}

                                    <button
                                      type="button"
                                      onClick={() => {
                                        const newList = [...(value || [])];
                                        const toolConfig = newList[serverIndex].tool_configuration || {};
                                        const tools = [...(toolConfig.tools || [])];
                                        const params = [...(tools[toolIndex].parameters || []), {
                                          name: "",
                                          type: "string",
                                          required: false,
                                          description: ""
                                        }];
                                        tools[toolIndex] = {
                                          ...tools[toolIndex],
                                          parameters: params
                                        };
                                        newList[serverIndex] = {
                                          ...newList[serverIndex],
                                          tool_configuration: {
                                            ...toolConfig,
                                            tools: tools
                                          }
                                        };
                                        onChange(field.key, newList);
                                      }}
                                      className="btn btn-primary btn-small"
                                    >
                                      Add Parameter
                                    </button>
                                  </div>
                                </div>
                              ))}

                              <button
                                type="button"
                                onClick={() => {
                                  const newList = [...(value || [])];
                                  const toolConfig = newList[serverIndex].tool_configuration || {};
                                  const tools = [...(toolConfig.tools || []), {
                                    name: "",
                                    description: "",
                                    parameters: [{
                                      name: "",
                                      type: "string",
                                      required: false,
                                      description: ""
                                    }]
                                  }];
                                  newList[serverIndex] = {
                                    ...newList[serverIndex],
                                    tool_configuration: {
                                      ...toolConfig,
                                      tools: tools
                                    }
                                  };
                                  onChange(field.key, newList);
                                }}
                                className="btn btn-primary btn-small"
                              >
                                Add Tool
                              </button>
                            </div>
                          </div>

                          {/* Prompts section */}
                          <div style={{ marginBottom: "16px" }}>
                            <h5 style={{ marginBottom: "8px" }}>Prompts</h5>
                            <div
                              style={{
                                backgroundColor: "var(--bg)",
                                padding: "12px",
                                borderRadius: "var(--radius)",
                                border: "1px solid var(--border-color)",
                              }}
                            >
                              {((server.tool_configuration || {}).prompts || []).map((prompt, promptIndex) => (
                                <div key={promptIndex} className="mb-4 pb-4" style={{ borderBottom: promptIndex < ((server.tool_configuration || {}).prompts || []).length - 1 ? "1px solid var(--border-color)" : "none" }}>
                                  <div style={{ display: "flex", justifyContent: "space-between", marginBottom: "10px" }}>
                                    <h6 style={{ margin: "0" }}>Prompt {promptIndex + 1}: {prompt.name || "New Prompt"}</h6>
                                    <button
                                      type="button"
                                      onClick={() => {
                                        const newList = [...(value || [])];
                                        const toolConfig = newList[serverIndex].tool_configuration || {};
                                        const prompts = [...(toolConfig.prompts || [])];
                                        prompts.splice(promptIndex, 1);
                                        newList[serverIndex] = {
                                          ...newList[serverIndex],
                                          tool_configuration: {
                                            ...toolConfig,
                                            prompts: prompts
                                          }
                                        };
                                        onChange(field.key, newList);
                                      }}
                                      className="btn btn-danger btn-small"
                                    >
                                      Remove
                                    </button>
                                  </div>

                                  <div style={{ marginBottom: "8px" }}>
                                    <label className="label mb-1 block">Name</label>
                                    <input
                                      className="input"
                                      type="text"
                                      value={prompt.name || ""}
                                      onChange={(e) => {
                                        const newList = [...(value || [])];
                                        const toolConfig = newList[serverIndex].tool_configuration || {};
                                        const prompts = [...(toolConfig.prompts || [])];
                                        prompts[promptIndex] = {
                                          ...prompts[promptIndex],
                                          name: e.target.value
                                        };
                                        newList[serverIndex] = {
                                          ...newList[serverIndex],
                                          tool_configuration: {
                                            ...toolConfig,
                                            prompts: prompts
                                          }
                                        };
                                        onChange(field.key, newList);
                                      }}
                                      placeholder="help"
                                    />
                                  </div>

                                  <div>
                                    <label className="label mb-1 block">Content</label>
                                    <textarea
                                      className="textarea"
                                      value={prompt.content || ""}
                                      onChange={(e) => {
                                        const newList = [...(value || [])];
                                        const toolConfig = newList[serverIndex].tool_configuration || {};
                                        const prompts = [...(toolConfig.prompts || [])];
                                        prompts[promptIndex] = {
                                          ...prompts[promptIndex],
                                          content: e.target.value
                                        };
                                        newList[serverIndex] = {
                                          ...newList[serverIndex],
                                          tool_configuration: {
                                            ...toolConfig,
                                            prompts: prompts
                                          }
                                        };
                                        onChange(field.key, newList);
                                      }}
                                      placeholder="Prompt content"
                                      rows={3}
                                    />
                                  </div>
                                </div>
                              ))}

                              <button
                                type="button"
                                onClick={() => {
                                  const newList = [...(value || [])];
                                  const toolConfig = newList[serverIndex].tool_configuration || {};
                                  const prompts = [...(toolConfig.prompts || []), {
                                    name: "",
                                    content: ""
                                  }];
                                  newList[serverIndex] = {
                                    ...newList[serverIndex],
                                    tool_configuration: {
                                      ...toolConfig,
                                      prompts: prompts
                                    }
                                  };
                                  onChange(field.key, newList);
                                }}
                                className="btn btn-primary btn-small"
                              >
                                Add Prompt
                              </button>
                            </div>
                          </div>

                          {/* Resources section */}
                          <div style={{ marginBottom: "16px" }}>
                            <h5 style={{ marginBottom: "8px" }}>Resources</h5>
                            <div
                              style={{
                                backgroundColor: "var(--bg)",
                                padding: "12px",
                                borderRadius: "var(--radius)",
                                border: "1px solid var(--border-color)",
                              }}
                            >
                              {((server.tool_configuration || {}).resources || []).map((resource, resourceIndex) => (
                                <div key={resourceIndex} className="mb-4 pb-4" style={{ borderBottom: resourceIndex < ((server.tool_configuration || {}).resources || []).length - 1 ? "1px solid var(--border-color)" : "none" }}>
                                  <div style={{ display: "flex", justifyContent: "space-between", marginBottom: "10px" }}>
                                    <h6 style={{ margin: "0" }}>Resource {resourceIndex + 1}: {resource.name || "New Resource"}</h6>
                                    <button
                                      type="button"
                                      onClick={() => {
                                        const newList = [...(value || [])];
                                        const toolConfig = newList[serverIndex].tool_configuration || {};
                                        const resources = [...(toolConfig.resources || [])];
                                        resources.splice(resourceIndex, 1);
                                        newList[serverIndex] = {
                                          ...newList[serverIndex],
                                          tool_configuration: {
                                            ...toolConfig,
                                            resources: resources
                                          }
                                        };
                                        onChange(field.key, newList);
                                      }}
                                      className="btn btn-danger btn-small"
                                    >
                                      Remove
                                    </button>
                                  </div>

                                  <div style={{ marginBottom: "8px" }}>
                                    <label className="label mb-1 block">URL</label>
                                    <input
                                      className="input"
                                      type="url"
                                      value={resource.url || ""}
                                      onChange={(e) => {
                                        const newList = [...(value || [])];
                                        const toolConfig = newList[serverIndex].tool_configuration || {};
                                        const resources = [...(toolConfig.resources || [])];
                                        resources[resourceIndex] = {
                                          ...resources[resourceIndex],
                                          url: e.target.value
                                        };
                                        newList[serverIndex] = {
                                          ...newList[serverIndex],
                                          tool_configuration: {
                                            ...toolConfig,
                                            resources: resources
                                          }
                                        };
                                        onChange(field.key, newList);
                                      }}
                                      placeholder="https://example.com/docs"
                                    />
                                  </div>

                                  <div style={{ marginBottom: "8px" }}>
                                    <label className="label mb-1 block">Name</label>
                                    <input
                                      className="input"
                                      type="text"
                                      value={resource.name || ""}
                                      onChange={(e) => {
                                        const newList = [...(value || [])];
                                        const toolConfig = newList[serverIndex].tool_configuration || {};
                                        const resources = [...(toolConfig.resources || [])];
                                        resources[resourceIndex] = {
                                          ...resources[resourceIndex],
                                          name: e.target.value
                                        };
                                        newList[serverIndex] = {
                                          ...newList[serverIndex],
                                          tool_configuration: {
                                            ...toolConfig,
                                            resources: resources
                                          }
                                        };
                                        onChange(field.key, newList);
                                      }}
                                      placeholder="documentation"
                                    />
                                  </div>

                                  <div>
                                    <label className="label mb-1 block">Description</label>
                                    <textarea
                                      className="textarea"
                                      value={resource.description || ""}
                                      onChange={(e) => {
                                        const newList = [...(value || [])];
                                        const toolConfig = newList[serverIndex].tool_configuration || {};
                                        const resources = [...(toolConfig.resources || [])];
                                        resources[resourceIndex] = {
                                          ...resources[resourceIndex],
                                          description: e.target.value
                                        };
                                        newList[serverIndex] = {
                                          ...newList[serverIndex],
                                          tool_configuration: {
                                            ...toolConfig,
                                            resources: resources
                                          }
                                        };
                                        onChange(field.key, newList);
                                      }}
                                      placeholder="Resource description"
                                    />
                                  </div>
                                </div>
                              ))}

                              <button
                                type="button"
                                onClick={() => {
                                  const newList = [...(value || [])];
                                  const toolConfig = newList[serverIndex].tool_configuration || {};
                                  const resources = [...(toolConfig.resources || []), {
                                    url: "",
                                    name: "",
                                    description: ""
                                  }];
                                  newList[serverIndex] = {
                                    ...newList[serverIndex],
                                    tool_configuration: {
                                      ...toolConfig,
                                      resources: resources
                                    }
                                  };
                                  onChange(field.key, newList);
                                }}
                                className="btn btn-primary btn-small"
                              >
                                Add Resource
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                  <button
                    type="button"
                    onClick={() => {
                      const newList = [...(value || []), {
                        name: "",
                        type: "mcp-server",
                        command: "",
                        args: [],
                        tool_configuration: {
                          tools: [],
                          prompts: [],
                          resources: []
                        }
                      }];
                      onChange(field.key, newList);
                    }}
                    className="btn btn-primary"
                  >
                    Add Server
                  </button>
                </div>
              </>
            ) : field.type === "skills-list" ? (
              <>
                {field.label && (
                  <label className="label mb-2 block">
                    {field.label}
                    {field.required && (
                      <span className="text-destructive ml-1">*</span>
                    )}
                  </label>
                )}
                <div
                  style={{
                    backgroundColor: "var(--primary-light)",
                    padding: "16px",
                    borderRadius: "var(--radius-lg)",
                    marginBottom: "24px",
                    border: "1px solid var(--border-color)",
                  }}
                >
                  {(
                    value || [
                      {
                        id: "",
                        name: "",
                        description: "",
                        examples: [""],
                        tags: [""],
                      },
                    ]
                  ).map((skill, skillIndex) => (
                    <div key={skillIndex} className="server-container">
                      <div className="server-header">
                        <h3 style={{ margin: "0", flex: "1" }}>
                          Skill {skillIndex + 1}: {skill.name || "New Skill"}
                        </h3>
                        {(value || []).length > 1 && (
                          <button
                            type="button"
                            onClick={() => {
                              const newList = (value || []).filter(
                                (_, i) => i !== skillIndex
                              );
                              onChange(field.key, newList);
                            }}
                            style={{
                              padding: "8px 16px",
                              backgroundColor:
                                "var(--Brand-Logo-Primary, #187ADC)",
                              color: "white",
                              border: "none",
                              borderRadius: "var(--radius)",
                              cursor: "pointer",
                              fontSize: "0.875rem",
                              fontWeight: "500",
                              transition: "var(--transition)",
                            }}
                          >
                            Remove Skill
                          </button>
                        )}
                      </div>
                      <div className="server-fields">
                        <div style={{ marginBottom: "16px" }}>
                          <label
                            style={{
                              fontWeight: "600",
                              display: "block",
                              marginTop: "20px",
                              marginBottom: "8px",
                              color: "var(--fg)",
                              fontSize: "0.875rem",
                            }}
                          >
                            Skill ID
                          </label>
                          <input
                            type="text"
                            value={skill.id || ""}
                            onChange={(e) => {
                              const newList = [...(value || [])];
                              newList[skillIndex] = {
                                ...skill,
                                id: e.target.value,
                              };
                              onChange(field.key, newList);
                            }}
                            style={{
                              width: "100%",
                              padding: "8px",
                              border: "1px solid var(--border-color, #ccc)",
                              borderRadius: "4px",
                              backgroundColor: "var(--input-bg, #fff)",
                              color: "var(--input-fg, #333)",
                            }}
                          />
                        </div>
                        <div style={{ marginBottom: "16px" }}>
                          <label
                            style={{
                              fontWeight: "600",
                              display: "block",
                              marginTop: "20px",
                              marginBottom: "8px",
                              color: "var(--fg)",
                              fontSize: "0.875rem",
                            }}
                          >
                            Skill Name
                          </label>
                          <input
                            type="text"
                            value={skill.name || ""}
                            onChange={(e) => {
                              const newList = [...(value || [])];
                              newList[skillIndex] = {
                                ...skill,
                                name: e.target.value,
                              };
                              onChange(field.key, newList);
                            }}
                            style={{
                              width: "100%",
                              padding: "8px",
                              border: "1px solid var(--border-color, #ccc)",
                              borderRadius: "4px",
                              backgroundColor: "var(--input-bg, #fff)",
                              color: "var(--input-fg, #333)",
                            }}
                          />
                        </div>
                        <div style={{ marginBottom: "16px" }}>
                          <label
                            style={{
                              fontWeight: "600",
                              display: "block",
                              marginTop: "20px",
                              marginBottom: "8px",
                              color: "var(--fg)",
                              fontSize: "0.875rem",
                            }}
                          >
                            Skill Description
                          </label>
                          <textarea
                            value={skill.description || ""}
                            onChange={(e) => {
                              const newList = [...(value || [])];
                              newList[skillIndex] = {
                                ...skill,
                                description: e.target.value,
                              };
                              onChange(field.key, newList);
                            }}
                            rows={3}
                            style={{
                              width: "100%",
                              padding: "8px",
                              border: "1px solid var(--border-color, #ccc)",
                              borderRadius: "4px",
                              backgroundColor: "var(--input-bg, #fff)",
                              color: "var(--input-fg, #333)",
                              resize: "vertical",
                            }}
                          />
                        </div>
                        <div style={{ marginBottom: "16px" }}>
                          <label
                            style={{
                              fontWeight: "600",
                              display: "block",
                              marginTop: "20px",
                              marginBottom: "8px",
                              color: "var(--fg)",
                              fontSize: "0.875rem",
                            }}
                          >
                            Skill Examples
                          </label>
                          <div className="dynamic-list-container">
                            {(skill.examples || [""]).map(
                              (example, exampleIndex) => (
                                <div
                                  key={exampleIndex}
                                  className="dynamic-list-item"
                                >
                                  <input
                                    type="text"
                                    value={example}
                                    onChange={(e) => {
                                      const newList = [...(value || [])];
                                      const newExamples = [
                                        ...(skill.examples || [""]),
                                      ];
                                      newExamples[exampleIndex] =
                                        e.target.value;
                                      newList[skillIndex] = {
                                        ...skill,
                                        examples: newExamples,
                                      };
                                      onChange(field.key, newList);
                                    }}
                                    placeholder="Enter skill example"
                                    style={{
                                      flex: 1,
                                      padding: "8px",
                                      border:
                                        "1px solid var(--border-color, #ccc)",
                                      borderRadius: "4px",
                                      backgroundColor: "var(--input-bg, #fff)",
                                      color: "var(--input-fg, #333)",
                                    }}
                                  />
                                  <button
                                    type="button"
                                    onClick={() => {
                                      if ((skill.examples || [""]).length <= 1)
                                        return;
                                      const newList = [...(value || [])];
                                      const newExamples = (
                                        skill.examples || [""]
                                      ).filter((_, i) => i !== exampleIndex);
                                      newList[skillIndex] = {
                                        ...skill,
                                        examples: newExamples,
                                      };
                                      onChange(field.key, newList);
                                    }}
                                    disabled={
                                      (skill.examples || [""]).length <= 1
                                    }
                                    style={{
                                      marginLeft: "8px",
                                      padding: "4px 8px",
                                      backgroundColor:
                                        "var(--Brand-Logo-Primary, #187ADC)",
                                      color: "white",
                                      border: "none",
                                      borderRadius: "4px",
                                      cursor: "pointer",
                                      opacity:
                                        (skill.examples || [""]).length <= 1
                                          ? 0.5
                                          : 1,
                                    }}
                                  >
                                    ×
                                  </button>
                                </div>
                              )
                            )}
                            <button
                              type="button"
                              onClick={() => {
                                const newList = [...(value || [])];
                                const newExamples = [
                                  ...(skill.examples || [""]),
                                  "",
                                ];
                                newList[skillIndex] = {
                                  ...skill,
                                  examples: newExamples,
                                };
                                onChange(field.key, newList);
                              }}
                              style={{
                                marginTop: "8px",
                                padding: "4px 8px",
                                backgroundColor: "var(--primary)",
                                color: "white",
                                border: "none",
                                borderRadius: "4px",
                                cursor: "pointer",
                              }}
                            >
                              + Add Example
                            </button>
                          </div>
                        </div>
                        <div style={{ marginBottom: "16px" }}>
                          <label
                            style={{
                              fontWeight: "600",
                              display: "block",
                              marginTop: "20px",
                              marginBottom: "8px",
                              color: "var(--fg)",
                              fontSize: "0.875rem",
                            }}
                          >
                            Skill Tags
                          </label>
                          <div className="dynamic-list-container">
                            {(skill.tags || [""]).map((tag, tagIndex) => (
                              <div key={tagIndex} className="dynamic-list-item">
                                <input
                                  type="text"
                                  value={tag}
                                  onChange={(e) => {
                                    const newList = [...(value || [])];
                                    const newTags = [...(skill.tags || [""])];
                                    newTags[tagIndex] = e.target.value;
                                    newList[skillIndex] = {
                                      ...skill,
                                      tags: newTags,
                                    };
                                    onChange(field.key, newList);
                                  }}
                                  placeholder="Enter skill tag"
                                  style={{
                                    flex: 1,
                                    padding: "8px",
                                    border:
                                      "1px solid var(--border-color, #ccc)",
                                    borderRadius: "4px",
                                    backgroundColor: "var(--input-bg, #fff)",
                                    color: "var(--input-fg, #333)",
                                  }}
                                />
                                <button
                                  type="button"
                                  onClick={() => {
                                    if ((skill.tags || [""]).length <= 1)
                                      return;
                                    const newList = [...(value || [])];
                                    const newTags = (skill.tags || [""]).filter(
                                      (_, i) => i !== tagIndex
                                    );
                                    newList[skillIndex] = {
                                      ...skill,
                                      tags: newTags,
                                    };
                                    onChange(field.key, newList);
                                  }}
                                  disabled={(skill.tags || [""]).length <= 1}
                                  style={{
                                    marginLeft: "8px",
                                    padding: "4px 8px",
                                    backgroundColor:
                                      "var(--Brand-Logo-Primary, #187ADC)",
                                    color: "white",
                                    border: "none",
                                    borderRadius: "4px",
                                    cursor: "pointer",
                                    opacity:
                                      (skill.tags || [""]).length <= 1
                                        ? 0.5
                                        : 1,
                                  }}
                                >
                                  ×
                                </button>
                              </div>
                            ))}
                            <button
                              type="button"
                              onClick={() => {
                                const newList = [...(value || [])];
                                const newTags = [...(skill.tags || [""]), ""];
                                newList[skillIndex] = {
                                  ...skill,
                                  tags: newTags,
                                };
                                onChange(field.key, newList);
                              }}
                              style={{
                                marginTop: "8px",
                                padding: "4px 8px",
                                backgroundColor: "var(--primary)",
                                color: "white",
                                border: "none",
                                borderRadius: "4px",
                                cursor: "pointer",
                              }}
                            >
                              + Add Tag
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                  <button
                    type="button"
                    onClick={() => {
                      const newSkill = {
                        id: "",
                        name: "",
                        description: "",
                        examples: [""],
                        tags: [""],
                      };
                      const newList = [...(value || []), newSkill];
                      onChange(field.key, newList);
                    }}
                    style={{
                      width: "100%",
                      padding: "12px",
                      backgroundColor: "var(--primary)",
                      color: "white",
                      border: "none",
                      borderRadius: "4px",
                      cursor: "pointer",
                      fontWeight: "bold",
                    }}
                  >
                    + Add Skill
                  </button>
                </div>
              </>
            ) : field.type === "oasf-skills-list" ? (
              <>
                {field.label && (
                  <label className="label mb-2 block">
                    {field.label}
                    {field.required && (
                      <span className="text-destructive ml-1">*</span>
                    )}
                  </label>
                )}
                <div
                  style={{
                    backgroundColor: "var(--primary-light)",
                    padding: "16px",
                    borderRadius: "var(--radius-lg)",
                    marginBottom: "24px",
                    border: "1px solid var(--border-color)",
                  }}
                >
                  {(
                    value || [
                      {
                        class_uid: 10101,
                        category_uid: 1,
                        category_name: "Natural Language Processing",
                        class_name: "Contextual Comprehension",
                      },
                    ]
                  ).map((skill, skillIndex) => (
                    <div key={skillIndex} className="server-container">
                      <div className="server-header">
                        <h3 style={{ margin: "0", flex: "1" }}>
                          OASF Skill {skillIndex + 1}:{" "}
                          {skill.class_name || "New OASF Skill"}
                        </h3>
                        {(value || []).length > 1 && (
                          <button
                            type="button"
                            onClick={() => {
                              const newList = (value || []).filter(
                                (_, i) => i !== skillIndex
                              );
                              onChange(field.key, newList);
                            }}
                            style={{
                              padding: "8px 16px",
                              backgroundColor:
                                "var(--Brand-Logo-Primary, #187ADC)",
                              color: "white",
                              border: "none",
                              borderRadius: "var(--radius)",
                              cursor: "pointer",
                              fontSize: "0.875rem",
                              fontWeight: "500",
                              transition: "var(--transition)",
                            }}
                          >
                            Remove OASF Skill
                          </button>
                        )}
                      </div>
                      <div className="server-fields">
                        <div style={{ marginBottom: "16px" }}>
                          <label
                            style={{
                              fontWeight: "600",
                              display: "block",
                              marginTop: "20px",
                              marginBottom: "8px",
                              color: "var(--fg)",
                              fontSize: "0.875rem",
                            }}
                          >
                            Class UID
                          </label>
                          <input
                            type="number"
                            value={skill.class_uid || ""}
                            onChange={(e) => {
                              const newList = [...(value || [])];
                              newList[skillIndex] = {
                                ...skill,
                                class_uid: parseInt(e.target.value) || 0,
                              };
                              onChange(field.key, newList);
                            }}
                            style={{
                              width: "100%",
                              padding: "8px",
                              border: "1px solid var(--border-color, #ccc)",
                              borderRadius: "4px",
                              backgroundColor: "var(--input-bg, #fff)",
                              color: "var(--input-fg, #333)",
                            }}
                          />
                        </div>
                        <div style={{ marginBottom: "16px" }}>
                          <label
                            style={{
                              fontWeight: "600",
                              display: "block",
                              marginTop: "20px",
                              marginBottom: "8px",
                              color: "var(--fg)",
                              fontSize: "0.875rem",
                            }}
                          >
                            Category UID
                          </label>
                          <input
                            type="number"
                            value={skill.category_uid || ""}
                            onChange={(e) => {
                              const newList = [...(value || [])];
                              newList[skillIndex] = {
                                ...skill,
                                category_uid: parseInt(e.target.value) || 0,
                              };
                              onChange(field.key, newList);
                            }}
                            style={{
                              width: "100%",
                              padding: "8px",
                              border: "1px solid var(--border-color, #ccc)",
                              borderRadius: "4px",
                              backgroundColor: "var(--input-bg, #fff)",
                              color: "var(--input-fg, #333)",
                            }}
                          />
                        </div>
                        <div style={{ marginBottom: "16px" }}>
                          <label
                            style={{
                              fontWeight: "600",
                              display: "block",
                              marginTop: "20px",
                              marginBottom: "8px",
                              color: "var(--fg)",
                              fontSize: "0.875rem",
                            }}
                          >
                            Category Name
                          </label>
                          <input
                            type="text"
                            value={skill.category_name || ""}
                            onChange={(e) => {
                              const newList = [...(value || [])];
                              newList[skillIndex] = {
                                ...skill,
                                category_name: e.target.value,
                              };
                              onChange(field.key, newList);
                            }}
                            style={{
                              width: "100%",
                              padding: "8px",
                              border: "1px solid var(--border-color, #ccc)",
                              borderRadius: "4px",
                              backgroundColor: "var(--input-bg, #fff)",
                              color: "var(--input-fg, #333)",
                            }}
                          />
                        </div>
                        <div style={{ marginBottom: "16px" }}>
                          <label
                            style={{
                              fontWeight: "600",
                              display: "block",
                              marginTop: "20px",
                              marginBottom: "8px",
                              color: "var(--fg)",
                              fontSize: "0.875rem",
                            }}
                          >
                            Class Name
                          </label>
                          <input
                            type="text"
                            value={skill.class_name || ""}
                            onChange={(e) => {
                              const newList = [...(value || [])];
                              newList[skillIndex] = {
                                ...skill,
                                class_name: e.target.value,
                              };
                              onChange(field.key, newList);
                            }}
                            style={{
                              width: "100%",
                              padding: "8px",
                              border: "1px solid var(--border-color, #ccc)",
                              borderRadius: "4px",
                              backgroundColor: "var(--input-bg, #fff)",
                              color: "var(--input-fg, #333)",
                            }}
                          />
                        </div>
                      </div>
                    </div>
                  ))}
                  <button
                    type="button"
                    onClick={() => {
                      const newSkill = {
                        class_uid: 10101,
                        category_uid: 1,
                        category_name: "",
                        class_name: "",
                      };
                      const newList = [...(value || []), newSkill];
                      onChange(field.key, newList);
                    }}
                    style={{
                      width: "100%",
                      padding: "12px",
                      backgroundColor: "var(--primary)",
                      color: "white",
                      border: "none",
                      borderRadius: "4px",
                      cursor: "pointer",
                      fontWeight: "bold",
                    }}
                  >
                    + Add OASF Skill
                  </button>
                </div>
              </>
            ) : field.type === "locators-list" ? (
              <>
                {field.label && (
                  <label className="label mb-2 block">
                    {field.label}
                    {field.required && (
                      <span className="text-destructive ml-1">*</span>
                    )}
                  </label>
                )}
                <div
                  style={{
                    backgroundColor: "var(--primary-light)",
                    padding: "16px",
                    borderRadius: "var(--radius-lg)",
                    marginBottom: "24px",
                    border: "1px solid var(--border-color)",
                  }}
                >
                  {(
                    value || [
                      { type: "source_code", url: "https://github.com/" },
                    ]
                  ).map((locator, locatorIndex) => (
                    <div key={locatorIndex} className="server-container">
                      <div className="server-header">
                        <h3 style={{ margin: "0", flex: "1" }}>
                          Locator {locatorIndex + 1}: source_code
                        </h3>
                        {(value || []).length > 1 && (
                          <button
                            type="button"
                            onClick={() => {
                              const newList = (value || []).filter(
                                (_, i) => i !== locatorIndex
                              );
                              onChange(field.key, newList);
                            }}
                            style={{
                              padding: "8px 16px",
                              backgroundColor:
                                "var(--Brand-Logo-Primary, #187ADC)",
                              color: "white",
                              border: "none",
                              borderRadius: "var(--radius)",
                              cursor: "pointer",
                              fontSize: "0.875rem",
                              fontWeight: "500",
                              transition: "var(--transition)",
                            }}
                          >
                            Remove Locator
                          </button>
                        )}
                      </div>
                      <div className="server-fields">
                        <div style={{ marginBottom: "16px" }}>
                          <label
                            style={{
                              fontWeight: "600",
                              display: "block",
                              marginTop: "20px",
                              marginBottom: "8px",
                              color: "var(--fg)",
                              fontSize: "0.875rem",
                            }}
                          >
                            Type
                          </label>
                          <input
                            type="text"
                            value="source_code"
                            readOnly
                            style={{
                              width: "100%",
                              padding: "8px",
                              border: "1px solid var(--border-color, #ccc)",
                              borderRadius: "4px",
                              backgroundColor: "var(--input-bg, #fff)",
                              color: "var(--input-fg, #333)",
                              opacity: 0.7,
                            }}
                          />
                        </div>
                        <div style={{ marginBottom: "16px" }}>
                          <label
                            style={{
                              fontWeight: "600",
                              display: "block",
                              marginTop: "20px",
                              marginBottom: "8px",
                              color: "var(--fg)",
                              fontSize: "0.875rem",
                            }}
                          >
                            URL
                          </label>
                          <input
                            type="url"
                            value={locator.url || ""}
                            onChange={(e) => {
                              const newList = [...(value || [])];
                              newList[locatorIndex] = {
                                ...locator,
                                url: e.target.value,
                              };
                              onChange(field.key, newList);
                            }}
                            style={{
                              width: "100%",
                              padding: "8px",
                              border: "1px solid var(--border-color, #ccc)",
                              borderRadius: "4px",
                              backgroundColor: "var(--input-bg, #fff)",
                              color: "var(--input-fg, #333)",
                            }}
                          />
                        </div>
                      </div>
                    </div>
                  ))}
                  <button
                    type="button"
                    onClick={() => {
                      const newLocator = {
                        type: "source_code",
                        url: "https://github.com/",
                      };
                      const newList = [...(value || []), newLocator];
                      onChange(field.key, newList);
                    }}
                    style={{
                      width: "100%",
                      padding: "12px",
                      backgroundColor: "var(--primary)",
                      color: "white",
                      border: "none",
                      borderRadius: "4px",
                      cursor: "pointer",
                      fontWeight: "bold",
                    }}
                  >
                    + Add Locator
                  </button>
                </div>
              </>
            ) : field.type === "a2a-card-loader" ? (
              <A2ACardLoader
                onLoadCard={(loadedData) => {
                  // Call bulk update
                  onChange("bulk-update", loadedData);
                }}
              />
            ) : field.type === "checkbox" ? (
              <label className="flex items-center gap-2">
                <input
                  type="checkbox"
                  checked={value || false}
                  onChange={(e) => onChange(field.key, e.target.checked)}
                  className="w-4 h-4"
                />
                <span className="text-sm">{field.label}</span>
              </label>
            ) : (
              <>
                {field.label && (
                  <label className="label mb-2 block">
                    {field.label}
                    {field.required && (
                      <span className="text-destructive ml-1">*</span>
                    )}
                  </label>
                )}
                {renderInput()}
                {error && (
                  <p className="text-destructive text-sm mt-1">{error}</p>
                )}
              </>
            )}
          </div>
        );
      }

      // Syntax highlighting function
      function syntaxHighlight(json) {
        if (!json) return "";
        json = json.replace(
          /(&|<|>)/g,
          (c) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;" }[c])
        );
        return json.replace(
          /("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(?=:)|\b(true|false)\b|null|"(.*?)"|\b([0-9]+)\b)/g,
          (match) => {
            if (/^".*"$/.test(match))
              return '<span class="json-string">' + match + "</span>";
            if (/true|false/.test(match))
              return '<span class="json-boolean">' + match + "</span>";
            if (/null/.test(match))
              return '<span class="json-null">' + match + "</span>";
            return '<span class="json-number">' + match + "</span>";
          }
        );
      }

      // Copy to clipboard function
      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            const notification = document.createElement("div");
            notification.textContent = "Copied to clipboard!";
            notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            z-index: 1000;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          `;
            document.body.appendChild(notification);
            setTimeout(() => {
              document.body.removeChild(notification);
            }, 2000);
          })
          .catch((err) => {
            console.error("Failed to copy text: ", err);
          });
      }

      // Extension Form Component
      function ExtensionForm({ config, data, onChange }) {
        const [formData, setFormData] = useState(data || {});
        const [errors, setErrors] = useState({});
        const handleFieldChange = (fieldKey, value) => {
          if (fieldKey === "bulk-update") {
            const mergedData = { ...formData, ...value };
            setFormData(mergedData);
            onChange(mergedData);
            return;
          }

          const newData = { ...formData, [fieldKey]: value };
          setFormData(newData);
          onChange(newData);

          if (errors[fieldKey]) {
            setErrors((prev) => ({ ...prev, [fieldKey]: null }));
          }
        };
        const validateForm = () => {
          const newErrors = {};
          config.fields.forEach((field) => {
            if (
              field.required &&
              (!formData[field.key] || formData[field.key] === "")
            ) {
              newErrors[field.key] = `${field.label} is required`;
            }
          });
          setErrors(newErrors);
          return Object.keys(newErrors).length === 0;
        };
        useEffect(() => {
          setFormData(data || {});
        }, [data]);
        return (
          <div className="space-y-4">
            {config.fields.map((field) => (
              <FormField
                key={field.key}
                field={field}
                value={formData[field.key]}
                onChange={handleFieldChange}
                error={errors[field.key]}
                formData={formData}
              />
            ))}
          </div>
        );
      }
      // Simple Skills List Component for OASF Base Record with API Integration
      function SimpleSkillsList({ value, onChange }) {
        const skills = Array.isArray(value) ? value : [{ id: "" }];
        const [availableSkills, setAvailableSkills] = useState([]);
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState("");
        const [skillCategories, setSkillCategories] = useState({});
        const [categories, setCategories] = useState([]);
        const [skillsByCategory, setSkillsByCategory] = useState({});

        // Fetch skills from OASF schema API
        useEffect(() => {
          const fetchSkills = async () => {
            try {
              setLoading(true);
              setError("");

              // Get the current OASF version from the global state
              const version = window.oasfVersion || "0.5.0";
              const url = `https://schema.oasf.outshift.com/${version}/api/main_skills?extensions=`;

              const response = await fetch(url);
              if (!response.ok) {
                throw new Error(`Failed to fetch skills: ${response.status}`);
              }

              const data = await response.json();

              // Process the skills data
              const processedSkills = [];
              const skillsByCat = {};
              const cats = [];

              // Extract skills from attributes and classes
              Object.entries(data.attributes).forEach(([attrKey, attribute]) => {
                if (attribute.classes) {
                  Object.entries(attribute.classes).forEach(([classKey, classData]) => {
                    if (classData.uid && classData.name) {
                      const skillItem = {
                        uid: classData.uid,
                        name: classData.name,
                        category: attribute.caption || attrKey,
                        description: classData.description || ""
                      };

                      processedSkills.push(skillItem);

                      // Group by category
                      if (!skillsByCat[skillItem.category]) {
                        skillsByCat[skillItem.category] = [];
                        cats.push(skillItem.category);
                      }
                      skillsByCat[skillItem.category].push(skillItem);
                    }
                  });
                }
              });

              setAvailableSkills(processedSkills);
              setSkillsByCategory(skillsByCat);
              setCategories(cats.sort());

              // Initialize skill categories with first category
              const initialCategories = {};
              skills.forEach((_, index) => {
                initialCategories[index] = cats.length > 0 ? cats[0] : "";
              });
              setSkillCategories(initialCategories);

            } catch (err) {
              console.error("Error fetching skills:", err);
              setError(`Failed to load skills: ${err.message}`);
            } finally {
              setLoading(false);
            }
          };

          fetchSkills();
        }, []);

        const updateSkill = (index, field, newValue) => {
          const newSkills = [...skills];
          newSkills[index] = { ...newSkills[index], [field]: newValue };
          onChange(newSkills);
        };

        const addSkill = () => {
          const newSkill = { id: "" };
          onChange([...skills, newSkill]);

          // Set default category for new skill
          setSkillCategories(prev => ({
            ...prev,
            [skills.length]: categories.length > 0 ? categories[0] : ""
          }));
        };

        const removeSkill = (index) => {
          if (skills.length > 1) {
            onChange(skills.filter((_, i) => i !== index));

            // Update skill categories
            const newSkillCategories = { ...skillCategories };
            delete newSkillCategories[index];

            // Reindex remaining categories
            const reindexedCategories = {};
            Object.keys(newSkillCategories).forEach((oldIndex) => {
              const numIndex = parseInt(oldIndex);
              if (numIndex > index) {
                reindexedCategories[numIndex - 1] = newSkillCategories[oldIndex];
              } else {
                reindexedCategories[numIndex] = newSkillCategories[oldIndex];
              }
            });

            setSkillCategories(reindexedCategories);
          }
        };

        // Handle skill selection from dropdown
        const handleSkillSelect = (index, skillUid) => {
          updateSkill(index, "id", skillUid);
        };

        // Handle category change for a specific skill
        const handleCategoryChange = (index, category) => {
          setSkillCategories(prev => ({
            ...prev,
            [index]: category
          }));
        };

        return (
          <div className="space-y-4">

            {/* Skills list */}
            {skills.map((skill, index) => (
              <div key={index} className="border border-gray-200 rounded-md p-3">
                <div className="flex justify-between items-center mb-2">
                  <h5 className="font-medium">Skill #{index + 1}</h5>
                  <button
                    type="button"
                    className="btn-danger btn-small"
                    onClick={() => removeSkill(index)}
                    disabled={skills.length <= 1}
                  >
                    Remove
                  </button>
                </div>

                <div className="space-y-3">
                  {/* Category selector inside each skill */}
                  {categories.length > 0 && (
                    <div>
                      <label className="label">Skill Category</label>
                      <select
                        className="select w-full"
                        value={skillCategories[index] || ""}
                        onChange={(e) => handleCategoryChange(index, e.target.value)}
                      >
                        {categories.map(category => (
                          <option key={category} value={category}>{category}</option>
                        ))}
                      </select>
                    </div>
                  )}

                  {/* Skill selector dropdown */}
                  {skillCategories[index] && skillsByCategory[skillCategories[index]] && (
                    <div>
                      <label className="label">Select Skill</label>
                      <select
                        className="select w-full"
                        value=""
                        onChange={(e) => handleSkillSelect(index, e.target.value)}
                      >
                        <option value="">-- Select a skill --</option>
                        {skillsByCategory[skillCategories[index]].map(skillOption => (
                          <option key={skillOption.uid} value={skillOption.uid}>
                            {skillOption.name} (ID: {skillOption.uid})
                          </option>
                        ))}
                      </select>
                    </div>
                  )}

                  {/* Manual ID input */}
                  <div>
                    <label className="label">Skill ID</label>
                    <input
                      className="input w-full"
                      type="number"
                      value={skill.id}
                      onChange={(e) => updateSkill(index, "id", e.target.value)}
                      placeholder="Skill ID (e.g. 601)"
                    />
                  </div>

                  {/* Show selected skill info if available */}
                  {availableSkills.find(s => s.uid == skill.id) && (
                    <div className="mt-2 p-2 bg-blue-50 dark:bg-blue-900 rounded">
                      <p className="text-sm font-medium">
                        {availableSkills.find(s => s.uid == skill.id).name}
                      </p>
                      <p className="text-xs text-gray-600 dark:text-gray-300">
                        {availableSkills.find(s => s.uid == skill.id).description}
                      </p>
                    </div>
                  )}
                </div>
              </div>
            ))}

            {/* Loading and error states */}
            {loading && <p className="text-sm text-gray-500">Loading skills...</p>}
            {error && <p className="text-sm text-red-500">{error}</p>}

            <button
              type="button"
              className="btn btn-primary btn-small"
              onClick={addSkill}
            >
              + Add Skill
            </button>
          </div>
        );
      }

      // Authors List Component for OASF Base Record
      function AuthorsList({ value, onChange }) {
        const authors = Array.isArray(value) ? value : [""];

        const updateAuthor = (index, newValue) => {
          const newAuthors = [...authors];
          newAuthors[index] = newValue;
          onChange(newAuthors);
        };

        const addAuthor = () => {
          onChange([...authors, ""]);
        };

        const removeAuthor = (index) => {
          if (authors.length > 1) {
            onChange(authors.filter((_, i) => i !== index));
          }
        };

        return (
          <div className="space-y-2">
            {authors.map((author, index) => (
              <div key={index} className="flex gap-2 items-center">
                <input
                  className="input flex-1"
                  type="text"
                  value={author}
                  onChange={(e) => updateAuthor(index, e.target.value)}
                  placeholder="Author Name"
                />
                <button
                  type="button"
                  className="btn-danger btn-small"
                  onClick={() => removeAuthor(index)}
                  disabled={authors.length <= 1}
                >
                  ×
                </button>
              </div>
            ))}
            <button
              type="button"
              className="btn btn-primary btn-small"
              onClick={addAuthor}
            >
              + Add Author
            </button>
          </div>
        );
      }

      // OASF Base Record Editor (always present, minimized by default)
      function OasfBaseRecordEditor({ record, onChange, minimized, onToggleMin }) {
        const [localRecord, setLocalRecord] = useState(record);
        const [formFields, setFormFields] = useState({
          name: record?.name || "",
          version: record?.version || "v3",
          description: record?.description || "",
          version: record?.version || "v0.5.0",
          skills: record?.skills || [{ id: "" }],
          authors: record?.authors || [""],
          created_at: record?.created_at || new Date().toISOString(),
          locators: record?.locators || [{ type: "source_code", url: "" }]
        });

        // Set OASF version in window object for SimpleSkillsList component
        useEffect(() => {
          window.oasfVersion = formFields.version.replace("v", "");
        }, [formFields.version]);

        // Update local record when record prop changes
        useEffect(() => {
          setLocalRecord(record);
          setFormFields({
            name: record?.name || "",
            version: record?.version || "v3",
            description: record?.description || "",
            version: record?.version || "v0.5.0",
            skills: record?.skills || [{ id: "" }],
            authors: record?.authors || [""],
            created_at: record?.created_at || new Date().toISOString(),
            locators: record?.locators || [{ type: "source_code", url: "" }]
          });
        }, [record]);

        // Handle JSON editor changes
        const handleJsonChange = (newRecord) => {
          setLocalRecord(newRecord);
          setFormFields({
            name: newRecord?.name || "",
            version: newRecord?.version || "v3",
            description: newRecord?.description || "",
            version: newRecord?.version || "v0.5.0",
            skills: newRecord?.skills || [{ id: "" }],
            authors: newRecord?.authors || [""],
            created_at: newRecord?.created_at || new Date().toISOString(),
            locators: newRecord?.locators || [{ type: "source_code", url: "" }]
          });
          onChange(newRecord);
        };

        // Handle form field changes with validation
        const handleFieldChange = (field, value) => {
          // Validate fields based on their type
          let validatedValue = value;
          let isValid = true;
          let errorMessage = "";

          switch(field) {
            case "skills":
              // Validate that each skill has a valid ID
              if (Array.isArray(value)) {
                validatedValue = value.map(skill => {
                  // Ensure ID is a number
                  if (skill.id && !isNaN(Number(skill.id))) {
                    return { ...skill, id: Number(skill.id) };
                  }
                  return skill;
                });
              }
              break;

            case "version":
              // Ensure schema version follows the pattern v0.0.0
              if (value && !value.match(/^v\d+(\.\d+)(\.\d+)?$/)) {
                isValid = false;
                errorMessage = "Schema version should be in format v0.0.0";
              }
              break;

            case "created_at":
              // Validate ISO date format
              try {
                new Date(value).toISOString();
              } catch (e) {
                isValid = false;
                errorMessage = "Created at should be a valid ISO date string";
              }
              break;

            case "locators":
              // Validate that each locator has required fields
              if (Array.isArray(value)) {
                isValid = value.every(locator =>
                  locator.type && locator.url && locator.url.startsWith("http"));
                if (!isValid) {
                  errorMessage = "Each locator must have a type and valid URL";
                }

                // Convert size to number if present
                validatedValue = value.map(locator => {
                  if (locator.size && !isNaN(Number(locator.size))) {
                    return { ...locator, size: Number(locator.size) };
                  }
                  return locator;
                });
              }
              break;
          }

          // If validation failed, show an error but still update the field
          if (!isValid && errorMessage) {
            console.warn(`Validation error for ${field}: ${errorMessage}`);
            // You could add a toast notification here
          }

          const newFormFields = { ...formFields, [field]: validatedValue };
          setFormFields(newFormFields);

          const newRecord = { ...localRecord, [field]: validatedValue };
          setLocalRecord(newRecord);
          onChange(newRecord);
        };

        return (
          <div
            className="card p-1 border-2 border-primary mb-6 cursor-pointer"
            onClick={(e) => {
              // Only toggle if clicking directly on the card or header elements
              // Don't toggle when clicking on form elements inside the expanded content
              const target = e.target;

              // Fix: Improved detection of form elements to prevent interference with input fields
              const isFormElement =
                target.tagName === 'INPUT' ||
                target.tagName === 'TEXTAREA' ||
                target.tagName === 'SELECT' ||
                target.tagName === 'BUTTON' ||
                target.tagName === 'LABEL' ||
                target.closest('input, textarea, select, button, a, label, .input, .textarea, .select') !== null;

              // Only toggle minimized state if not clicking on a form element
              if (!isFormElement || minimized) {
                onToggleMin();
              }
            }}
          >
            {/* Header */}
            <div className="flex items-center justify-between mb-2">
              <div className="ml-3 flex items-center">
                <div
                  className="w-10 h-10 rounded-full flex items-center justify-center text-white"
                  style={{ background: "linear-gradient(135deg, var(--primary-light), var(--primary))" }}
                >
                  📝
                </div>
                <div>
                  <h3 className="font-semibold text-lg ml-3">OASF Base Record Editor</h3>
                  <p className="text-sm text-muted-foreground ml-3">
                    Edit the complete OASF Base Record directly {minimized ? "(click to expand)" : "(click to collapse)"}
                  </p>
                </div>
              </div>
              <span
                className="text-blue-500 flex items-center justify-center"
                title={minimized ? "Expand" : "Minimize"}
                style={{ fontSize: 20 }}
              >
                <span style={{ color: "var(--blue-500)" }}>
                  {minimized ? "➕" : "➖"}
                </span>
              </span>
            </div>
            {!minimized && (
              <>
                {/* Form Fields */}
                <div className="mb-6 p-4 border border-gray-300 rounded-md dark:border-gray-600 dark:bg-gray-900">
                  <h4 className="text-lg font-bold mb-4 dark:text-white">Base Fields</h4>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                      <label className="label">Name</label>
                      <input
                        className="input"
                        type="text"
                        value={formFields.name}
                        onChange={(e) => handleFieldChange("name", e.target.value)}
                        placeholder="Name"
                      />
                    </div>
                    <div>
                      <label className="label">Version</label>
                      <input
                        className="input"
                        type="text"
                        value={formFields.version}
                        onChange={(e) => handleFieldChange("version", e.target.value)}
                        placeholder="Version (e.g. v3)"
                      />
                    </div>
                  </div>

                  <div className="mb-4">
                    <label className="label">Description</label>
                    <textarea
                      className="textarea"
                      value={formFields.description}
                      onChange={(e) => handleFieldChange("description", e.target.value)}
                      placeholder="Description"
                    />
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                      <label className="label">Schema Version</label>
                      <input
                        className="input"
                        type="text"
                        value={formFields.version}
                        onChange={(e) => handleFieldChange("version", e.target.value)}
                        placeholder="Schema Version (e.g. v0.5.0)"
                      />
                    </div>
                    <div>
                      <label className="label">Created At</label>
                      <input
                        className="input"
                        type="text"
                        value={formFields.created_at}
                        onChange={(e) => handleFieldChange("created_at", e.target.value)}
                        placeholder="Created At (ISO format)"
                      />
                    </div>
                  </div>

                  <div className="mb-4">
                    <label className="label">Skills</label>
                    <SimpleSkillsList
                      value={formFields.skills}
                      onChange={(value) => handleFieldChange("skills", value)}
                    />
                  </div>

                  <div className="mb-4">
                    <label className="label">Authors</label>
                    <AuthorsList
                      value={formFields.authors}
                      onChange={(value) => handleFieldChange("authors", value)}
                    />
                  </div>

                  <div className="mb-4">
                    <label className="label">Locators</label>
                    <LocatorsList
                      value={formFields.locators}
                      onChange={(value) => handleFieldChange("locators", value)}
                    />
                  </div>
                </div>
              </>
            )}
          </div>
        );
      }

      // Extension Card Component
      function ExtensionCard({
        extension,
        onUpdate,
        onRemove,
        onDuplicate,
        onToggle,
      }) {
        // Otherwise render a regular extension card
        const config = extensionConfigs[extension.extensionType];
        const isCollapsed = extension.collapsed === "true";
        if (!config) return null;
        return (
          <div
            className={`card extension-card ${
              isCollapsed ? "collapsed" : "expanded"
            }`}
          >
            <div className="p-0">
              {/* Header */}
              <div className="flex items-center justify-between mb-4 ml-6 mt-2">
                <div className="flex items-center gap-3">
                  <div
                    className={`extension-icon ${config.iconClass} text-white`}
                    style={{ width: "32px", height: "32px", fontSize: "18px" }}
                  >
                    {config.icon}
                  </div>
                  <div>
                    <h3 className="font-semibold text-lg">{extension.name}</h3>
                    <p className="text-sm text-muted-foreground">
                      Extension #{extension.id.split("_")[1] || "1"}
                    </p>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  <button
                    className="btn btn-ghost"
                    onClick={() => onToggle(extension.id)}
                  >
                    {isCollapsed ? "▼" : "▲"}
                  </button>
                  <button
                    className="btn btn-ghost"
                    onClick={() => onDuplicate(extension.id)}
                  >
                    📋
                  </button>
                  <button
                    className="btn btn-ghost"
                    onClick={() => onRemove(extension.id)}
                  >
                    🗑️
                  </button>
                </div>
              </div>

              {/* Form */}
              {!isCollapsed && (
                <ExtensionForm
                  config={config}
                  data={extension.data}
                  onChange={(data) => onUpdate(extension.id, data)}
                />
              )}
            </div>
          </div>
        );
      }

      function JsonPreview({ extensions, isVisible, onClose, oasfRecord }) {
        const [isValidOasf, setIsValidOasf] = useState(false);
        const [isValidating, setIsValidating] = useState(false);
        const [schemaError, setSchemaError] = useState("");

        // Fetch schema and validate when modal is opened
        useEffect(() => {
          if (isVisible) {
            validateAgainstOasfSchema();
          }
        }, [isVisible, extensions, oasfRecord]);

        // Fetch OASF schema and validate the generated record
        const validateAgainstOasfSchema = async () => {
          setIsValidating(true);
          setSchemaError("");

          try {
            // Generate the current record
            const generatedRecord = generateOASFRecord();
            console.log("Generated record for validation:", generatedRecord);

            // Simple client-side validation - check for required fields
            const requiredFields = ["name", "version", "authors"];
            const missingFields = requiredFields.filter(field => !generatedRecord[field]);

            if (missingFields.length > 0) {
              setIsValidOasf(false);
              setSchemaError(`Missing required fields: ${missingFields.join(", ")}`);
              return;
            }

            // Check if extensions array exists and has valid structure
            if (!generatedRecord.extensions || !Array.isArray(generatedRecord.extensions)) {
              setIsValidOasf(false);
              setSchemaError("Extensions array is missing or invalid");
              return;
            }


            const invalidExtensions = generatedRecord.extensions.filter((ext, index) => {
              if (!ext.schema && !ext.name) {
                return true;
              }
              if (!ext.data) {
                return true;
              }
              return false;
            });

            if (invalidExtensions.length > 0) {
              setIsValidOasf(false);
              setSchemaError(`${invalidExtensions.length} extension(s) have invalid structure`);
              return;
            }


            setIsValidOasf(true);
            console.log("OASF record validation passed");

          } catch (error) {
            console.error("Schema validation error:", error);
            setIsValidOasf(false);
            setSchemaError(`Validation error: ${error.message}`);
          } finally {
            setIsValidating(false);
          }
        };

        useEffect(() => {
          if (isVisible) {
            document.body.style.overflow = "hidden";
          } else {
            document.body.style.overflow = "unset";
          }

          const handleEscape = (e) => {
            if (e.key === "Escape" && isVisible) {
              onClose();
            }
          };

          if (isVisible) {
            document.addEventListener("keydown", handleEscape);
          }

          // Cleanup on unmount
          return () => {
            document.body.style.overflow = "unset";
            document.removeEventListener("keydown", handleEscape);
          };
        }, [isVisible, onClose]);

        const generateOASFRecord = () => {
          console.log("Generating OASF record with extensions:", extensions);
          const features = extensions
            .map((ext) => {
              const config = extensionConfigs[ext.extensionType];
              if (!config) return null;

              // Handle custom JSON extension differently
              if (ext.extensionType === "custom") {
                // Use the schema URI provided by the user
                const schemaUri = ext.data.schema || config.schemaName;

                // Get the custom JSON data
                const jsonData = ext.data["json-input"] || {};

                return {
                  schema: schemaUri,
                  data: jsonData,
                };
              }

              // Handle A2A extension with raw data
              if (ext.extensionType === "a2a" && ext.data.raw_data) {
                // Use the raw A2A card data directly
                return {
                  schema: "schema.oasf.agntcy.org/features/runtime/a2a",
                  data: ext.data.raw_data,
                };
              }

              // Handle MCP extension with nested servers structure
              if (ext.extensionType === "mcp") {
                console.log("Processing MCP extension:", ext);
                console.log("MCP data structure:", ext.data);
                console.log("MCP servers:", ext.data.servers);

                // Check if servers array exists
                if (ext.data.servers && Array.isArray(ext.data.servers)) {
                  console.log("MCP servers array found with", ext.data.servers.length, "servers");

                  // Ensure the MCP extension data is properly structured
                  const mcpData = {
                    schema: config.schemaName,
                    name: config.schemaName,
                    data: {
                      servers: ext.data.servers.map(server => {
                        // Ensure each server has the required properties
                        return {
                          name: server.name || "",
                          type: server.type || "http",
                          command: server.command || "",
                          args: server.args || [],
                          tool_configuration: {
                            tools: (server.tool_configuration?.tools || []).map(tool => ({
                              name: tool.name || "",
                              description: tool.description || "",
                              parameters: (tool.parameters || []).map(param => ({
                                name: param.name || "",
                                type: param.type || "string",
                                required: param.required || false,
                                description: param.description || ""
                              }))
                            })),
                            prompts: (server.tool_configuration?.prompts || []).map(prompt => ({
                              name: prompt.name || "",
                              content: prompt.content || ""
                            })),
                            resources: (server.tool_configuration?.resources || []).map(resource => ({
                              url: resource.url || "",
                              name: resource.name || "",
                              description: resource.description || ""
                            }))
                          }
                        };
                      })
                    }
                  };

                  console.log("Generated MCP data:", mcpData);
                  return mcpData;
                } else {
                  console.log("MCP servers array not found or not an array");
                  // Fall back to regular extension handling
                  return {
                    schema: "schema.oasf.agntcy.org/features/runtime/mcp",
                    data: ext.data
                  };
                }
              }


              // Handle regular extensions
              return {
                schema: config.schemaName,
                data: ext.data,
              };
            })
            .filter(Boolean);

          // Use the OASF Base Record Editor contents from the passed oasfRecord prop
          return {
            // Use values from oasfRecord prop
            name: oasfRecord?.name || "Generated Agent",
            description: oasfRecord?.description || "Agent generated using AGNTCY OASF Record Generator",
            version: oasfRecord?.version || "0.5.0",
            authors: oasfRecord?.authors || ["Cisco Outshift Contributors"],
            skills: oasfRecord?.skills || [],
            created_at: oasfRecord?.created_at || new Date().toISOString(),
            locators: oasfRecord?.locators || [],
            extensions: features, // Renamed from 'features' to 'extensions' to match OASF specification
            metadata: {
              generator: "AGNTCY OASF Record Generator",
              generated_at: new Date().toISOString(),
            },
          };
        };
        const downloadJson = () => {
          const record = generateOASFRecord();
          const blob = new Blob([JSON.stringify(record, null, 2)], {
            type: "application/json",
          });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "oasf-record.json";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        };
        if (!isVisible) return null;
        return (
          <div
            className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4"
            style={{
              zIndex: 9999,
              position: "fixed",
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
            }}
            onClick={(e) => {
              if (e.target === e.currentTarget) {
                const modalContent = e.currentTarget.querySelector(".card");
                if (modalContent) {
                  const scrollContainer =
                    modalContent.querySelector(".overflow-auto");
                  if (scrollContainer && scrollContainer.scrollTop > 0) {
                    scrollContainer.scrollTo({
                      top: 0,
                      behavior: "smooth",
                    });
                    return;
                  }
                }
                onClose();
              }
            }}
            onWheel={(e) => {
              e.stopPropagation();
            }}
          >
            <div
              className="card max-w-4xl w-full h-auto max-h-[90vh] overflow-hidden"
              style={{
                position: "relative",
                zIndex: 10000,
                backgroundColor: "var(--card)",
                border: "1px solid var(--border-color)",
                borderRadius: "var(--radius-lg)",
                boxShadow:
                  "0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",
              }}
              onClick={(e) => e.stopPropagation()}
            >
              <div className="p-6 flex flex-col h-full max-h-[90vh]">
                <div className="flex items-center justify-between mb-4 flex-shrink-0">
                  <div className="flex items-center gap-4">
                    <h2 className="text-xl font-bold">OASF Record</h2>
                    {isValidating ? (
                      <span className="text-yellow-500 text-sm flex items-center gap-1">
                        <svg className="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                          <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Validating...
                      </span>
                    ) : isValidOasf ? (
                      <div className="flex items-center gap-1 text-green-600 text-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                        </svg>
                        <span>Valid OASF Record</span>
                      </div>
                    ) : (
                      <div className="flex items-center gap-1 text-red-600 text-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                        </svg>
                        <span>Invalid OASF Record</span>
                        {schemaError && <span className="ml-1">({schemaError})</span>}
                      </div>
                    )}
                  </div>
                  <div className="flex items-center gap-2">
                    <button
                      className="btn btn-secondary"
                      onClick={() =>
                        copyToClipboard(
                          JSON.stringify(generateOASFRecord(), null, 2)
                        )
                      }
                    >
                      🖨️ Copy OASF Record
                    </button>
                    <button className="btn btn-primary" onClick={downloadJson}>
                      📥 Download JSON
                    </button>
                    <button
                      className="btn btn-ghost"
                      onClick={onClose}
                      style={{
                        fontSize: "18px",
                        fontWeight: "bold",
                        minWidth: "40px",
                        minHeight: "40px",
                        position: "relative",
                        zIndex: 10001,
                        transition: "all 0.2s ease",
                      }}
                      title="Close Modal (ESC or click outside)"
                      onMouseEnter={(e) => {
                        e.target.style.backgroundColor = "var(--destructive)";
                        e.target.style.color = "white";
                      }}
                      onMouseLeave={(e) => {
                        e.target.style.backgroundColor = "";
                        e.target.style.color = "";
                      }}
                    >
                      ✕
                    </button>
                  </div>
                </div>
                <div
                  style={{
                    marginTop: "10px",
                    marginBottom: "16px",
                    textAlign: "center",
                    fontSize: "14px",
                    color: "var(--fg)",
                  }}
                >
                  Upload your agent card using{" "}
                  <a
                    href="https://docs.agntcy.org/dir/scenarios/"
                    target="_blank"
                    style={{
                      textDecoration: "underline",
                      color: "var(--primary)",
                    }}
                  >
                    AGNTCY dirctl instructions
                  </a>{" "}
                  to reference Agent Directory at{" "}
                  <a
                    href="https://agent-directory.outshift.com/"
                    target="_blank"
                    style={{
                      textDecoration: "underline",
                      color: "var(--primary)",
                    }}
                  >
                    agent-directory.outshift.com
                  </a>
                </div>
                <div
                  className="overflow-auto flex-1 min-h-0"
                  style={{
                    maxHeight: "calc(90vh - 120px)",
                    overflowY: "auto",
                    overflowX: "auto",
                  }}
                >
                  <pre
                    className="json-output"
                    dangerouslySetInnerHTML={{
                      __html: syntaxHighlight(
                        JSON.stringify(generateOASFRecord(), null, 2)
                      ),
                    }}
                  />
                </div>
              </div>
            </div>
          </div>
        );
      }

      function App() {
        const [activeTab, setActiveTab] = useState("extensions");
        const [theme, setTheme] = useState("light");
        const [showPreview, setShowPreview] = useState(false);
        const [activeExtensions, setActiveExtensions] = useState([]);
        const [nextId, setNextId] = useState(1);
        const [toasts, setToasts] = useState([]);
        const [showConfirmDialog, setShowConfirmDialog] = useState(false);
        const [importFileData, setImportFileData] = useState(null);
        const [showBackToTop, setShowBackToTop] = useState(false);
        const [oasfVersion, setOasfVersion] = useState("0.5.0");
        const [isSchemaLoading, setIsSchemaLoading] = useState(false);
        const [oasfRecord, setOasfRecord] = useState({
          name: "Generated Agent",
          description: "Agent generated using AGNTCY OASF Record Generator",
          version: "0.5.0",
          authors: ["Cisco Outshift Contributors"],
          features: [],
          metadata: {
            generator: "AGNTCY OASF Record Generator",
            generated_at: new Date().toISOString(),
          }
        });
        const [oasfEditorMinimized, setOasfEditorMinimized] = useState(true);

        // Reference for the app container to handle drag events
        const appContainerRef = React.useRef(null);

        // Handle scroll to top functionality
        const scrollToTop = () => {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        };

        // Set up scroll event listener for back to top button
        useEffect(() => {
          const handleScroll = () => {
            if (window.scrollY > 300) {
              setShowBackToTop(true);
            } else {
              setShowBackToTop(false);
            }
          };

          window.addEventListener('scroll', handleScroll);
          return () => {
            window.removeEventListener('scroll', handleScroll);
          };
        }, []);

        // Set up drag and drop event handlers
        useEffect(() => {
          const container = appContainerRef.current;
          if (!container) return;

          const handleDragOver = (e) => {
            e.preventDefault();
            e.stopPropagation();
            container.classList.add('drag-over');
          };

          const handleDragLeave = (e) => {
            e.preventDefault();
            e.stopPropagation();
            container.classList.remove('drag-over');
          };

          const handleDrop = (e) => {
            e.preventDefault();
            e.stopPropagation();
            container.classList.remove('drag-over');

            if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
              const file = e.dataTransfer.files[0];
              if (file.type === 'application/json' || file.name.endsWith('.json')) {
                // Read the file and prepare for import
                const reader = new FileReader();
                reader.onload = (e) => {
                  try {
                    const data = JSON.parse(e.target.result);
                    // Store the data and show confirmation dialog
                    setImportFileData(data);
                    setShowConfirmDialog(true);
                  } catch (error) {
                    console.error('Error parsing JSON file:', error);
                    addToast('Invalid JSON file. Please check the file format.', 'error');
                  }
                };
                reader.readAsText(file);
              } else {
                addToast('Please drop a JSON file.', 'error');
              }
            }
          };

          // Add event listeners
          container.addEventListener('dragover', handleDragOver);
          container.addEventListener('dragleave', handleDragLeave);
          container.addEventListener('drop', handleDrop);

          // Cleanup
          return () => {
            container.removeEventListener('dragover', handleDragOver);
            container.removeEventListener('dragleave', handleDragLeave);
            container.removeEventListener('drop', handleDrop);
          };
        }, []);

        // Fetch and update schema information when the app loads
        useEffect(() => {
          const updateSchemas = async () => {
            setIsSchemaLoading(true);
            try {
              // First fetch the latest version
              const version = await fetchLatestOASFVersion();
              setOasfVersion(version);

              // Then update the schemas
              await updateExtensionConfigsFromSchema(version, setOasfVersion);
              addToast(`OASF Schema updated to version ${version}`, "success");
            } catch (error) {
              console.error("Error updating schemas:", error);
              // addToast("Failed to update OASF schemas", "error");
            } finally {
              setIsSchemaLoading(false);
            }
          };

          updateSchemas();
        }, []);

        // Add scroll event listener to show/hide Back to Top button
        useEffect(() => {
          const handleScroll = () => {
            if (window.pageYOffset > 300) {
              setShowBackToTop(true);
            } else {
              setShowBackToTop(false);
            }
          };

          window.addEventListener('scroll', handleScroll);
          return () => {
            window.removeEventListener('scroll', handleScroll);
          };
        }, []);

        // Function to scroll back to top is already defined above

        // Add refresh protection to prevent accidental data loss
        useEffect(() => {
          // Only add the protection if there are active extensions
          const handleBeforeUnload = (e) => {
            if (activeExtensions.length > 0) {
              // Standard way of showing a confirmation dialog before page unload
              e.preventDefault();
              // Chrome requires returnValue to be set
              e.returnValue = '';
              return '';
            }
          };

          // Add event listener
          window.addEventListener('beforeunload', handleBeforeUnload);

          // Clean up the event listener when component unmounts
          return () => {
            window.removeEventListener('beforeunload', handleBeforeUnload);
          };
        }, [activeExtensions.length]);

        // Functions to collapse and expand all extensions
        const collapseAllExtensions = () => {
          setActiveExtensions((prev) =>
            prev.map((ext) => ({ ...ext, collapsed: "true" }))
          );
          addToast("All extensions collapsed", "warning");
        };

        const expandAllExtensions = () => {
          setActiveExtensions((prev) =>
            prev.map((ext) => ({ ...ext, collapsed: "false" }))
          );
          addToast("All extensions expanded", "warning");
        };


        const addToast = (message, type = "success") => {
          const id = Date.now() + Math.random();
          setToasts((prev) => [...prev, { id, message, type }]);
        };

        const removeToast = (id) => {
          setToasts((prev) => prev.filter((toast) => toast.id !== id));
        };
        const availableExtensions = Object.entries(extensionConfigs).map(
          ([id, config]) => ({
            id,
            ...config,
            category:
              id === "observability" || id === "evaluation"
                ? "monitoring"
                : "runtime",
          })
        );
        // Function to add the OASF Base Record editor (singleton)
        const addOasfEditor = () => {
          if (hasOasfEditor) {
            addToast("OASF Editor is already added", "warning");
            return;
          }

          // Create a special OASF Editor extension
          const oasfEditorExtension = {
            id: `oasf-editor_${nextId}`,
            extensionType: "oasf-editor",
            name: "OASF Base Record Editor",
            data: {
              // Initialize with an empty record structure
              record: {
                name: "Generated Agent",
                description: "Agent generated using AGNTCY OASF Record Generator",
                version: "0.5.0",
                authors: ["Cisco Outshift Contributors"],
                features: [],
                metadata: {
                  generator: "AGNTCY OASF Record Generator",
                  generated_at: new Date().toISOString(),
                }
              }
            },
            collapsed: "false",
            order: 0, // Always first
            isEditor: true // Special flag to identify this as the editor
          };

          // Add it to the beginning of active extensions
          setActiveExtensions((prev) => [oasfEditorExtension, ...prev]);
          setNextId((prev) => prev + 1);
          setHasOasfEditor(true);
        };
        const addExtension = (extensionId) => {
          // If extensionId is a string like 'model', 'prompt', etc. (direct extension type)
          if (typeof extensionId === 'string' && extensionConfigs[extensionId]) {
            const extensionType = extensionId;
            const config = extensionConfigs[extensionType];

            // Initialize with default values for A2A extension
            let defaultData = {};
            if (extensionType === "a2a") {
              defaultData = {
                defaultInputModes: ["text"],
                defaultOutputModes: ["text"],
              };
            }

            const newExtension = {
              id: `${extensionType}_${nextId}`,
              extensionType,
              name: config.name,
              data: defaultData,
              collapsed: "false",
              order: activeExtensions.length,
            };

            setActiveExtensions((prev) => [...prev, newExtension]);
            setNextId((prev) => prev + 1);

            addToast(`Added ${config.name}`, "success");
            return;
          }

          // Find the extension in availableExtensions by id
          const extension = availableExtensions.find(ext => ext.id === extensionId);
          if (!extension) return;

          const extensionType = extension.id;
          const config = extensionConfigs[extensionType];
          if (!config) return;

          // Initialize with default values for A2A extension
          let defaultData = {};
          if (extensionType === "a2a") {
            defaultData = {
              defaultInputModes: ["text"],
              defaultOutputModes: ["text"],
            };
          }

          const newExtension = {
            id: `${extensionType}_${nextId}`,
            extensionType,
            name: config.name,
            data: defaultData,
            collapsed: "false",
            order: activeExtensions.length,
          };
          setActiveExtensions((prev) => [...prev, newExtension]);
          setNextId((prev) => prev + 1);

          addToast(`Added ${config.name}`, "success");
        };
        const updateExtension = (instanceId, data) => {
          setActiveExtensions((prev) =>
            prev.map((ext) => (ext.id === instanceId ? { ...ext, data } : ext))
          );
        };
        const removeExtension = (instanceId) => {
          const extension = activeExtensions.find(
            (ext) => ext.id === instanceId
          );
          const config = extension
            ? extensionConfigs[extension.extensionType]
            : null;

          setActiveExtensions((prev) =>
            prev.filter((ext) => ext.id !== instanceId)
          );

          if (config) {
            addToast(`Removed ${config.name}`, "warning");
          }
        };
        const duplicateExtension = (instanceId) => {
          const extension = activeExtensions.find(
            (ext) => ext.id === instanceId
          );
          if (!extension) return;

          const config = extensionConfigs[extension.extensionType];
          const newExtension = {
            ...extension,
            id: `${extension.extensionType}_${nextId}`,
            order: activeExtensions.length,
          };
          setActiveExtensions((prev) => [...prev, newExtension]);
          setNextId((prev) => prev + 1);

          if (config) {
            addToast(`Duplicated ${config.name}`, "success");
          }
        };
        const toggleExtension = (instanceId) => {
          setActiveExtensions((prev) =>
            prev.map((ext) =>
              ext.id === instanceId
                ? {
                    ...ext,
                    collapsed: ext.collapsed === "true" ? "false" : "true",
                  }
                : ext
            )
          );
        };

        const validateAllExtensions = () => {
          const validationErrors = [];

          activeExtensions.forEach((extension) => {
            const config = extensionConfigs[extension.extensionType];
            if (!config) return;

            const missingFields = [];
            config.fields.forEach((field) => {
              if (field.required) {
                const value = extension.data[field.key];
                if (
                  !value ||
                  value === "" ||
                  (Array.isArray(value) &&
                    (value.length === 0 ||
                      value.every((item) => !item || item === "")))
                ) {
                  missingFields.push(field.label || field.key);
                }
              }
            });

            if (missingFields.length > 0) {
              validationErrors.push({
                extensionName: config.name,
                missingFields: missingFields,
              });
            }
          });

          return validationErrors;
        };

        const handleGenerateOASF = () => {
          // Check if there are any extensions added
          if (activeExtensions.length === 0) {
            addToast("Please add at least one extension to generate an OASF record", "error");
            return;
          }

          // Validate all extensions
          const validationErrors = validateAllExtensions();

          if (validationErrors.length > 0) {
            addToast("Please fill all mandatory fields", "error");
            return;
          }

          setShowPreview(true);
        };

        // Detect if imported JSON is an A2A card format
        const isA2ACardFormat = (data) => {
          return (
            data &&
            typeof data === "object" &&
            (data.name ||
              data.version ||
              data.description ||
              data.capabilities ||
              data.skills) &&
            !data.extensions &&
            !data.version
          );
        };

        // Check if imported JSON is an OASF record
        const isOASFRecord = (data) => {
          console.log("Checking if imported JSON is an OASF record");
          console.log("Data:", data);
          console.log("Version:", data?.version);
          console.log("Extensions:", data?.extensions);

          // Check if extensions array exists and has at least one item with schema or name
          let hasValidExtensions = false;
          if (data?.extensions && Array.isArray(data.extensions)) {
            console.log("Extensions count:", data.extensions.length);
            data.extensions.forEach((ext, i) => {
              console.log(`Extension ${i}:`, ext);
              console.log(`Extension ${i} schema:`, ext?.schema || ext?.name);
              if (ext?.schema || ext?.name) {
                hasValidExtensions = true;
              }
            });
          }

          const result =
            data &&
            typeof data === "object" &&
            data.version &&
            data.extensions &&
            Array.isArray(data.extensions) &&
            hasValidExtensions;

          console.log("Has valid extensions:", hasValidExtensions);
          console.log("Is OASF record:", result);
          return result;
        };

        const convertA2ACardToExtensionData = (cardData) => {
          const formData = {};

          let githubUrl = null;

          if (cardData.url && cardData.url.includes("github.com")) {
            githubUrl = cardData.url;
          }

          if (
            !githubUrl &&
            cardData.locators &&
            Array.isArray(cardData.locators)
          ) {
            const githubLocator = cardData.locators.find(
              (locator) => locator.url && locator.url.includes("github.com")
            );
            if (githubLocator) {
              githubUrl = githubLocator.url;
            }
          }

          if (githubUrl) {
            const githubMatch = githubUrl.match(
              /github(?:usercontent)?\.com\/([^\/]+)\/([^\/]+)/
            );
            if (githubMatch) {
              const owner = githubMatch[1];
              const repo = githubMatch[2];

              if (!cardData.authors || cardData.authors.length === 0) {
                formData.authors = [owner];
              } else {
                formData.authors = cardData.authors;
              }
            } else {
              formData.authors = cardData.authors || [""];
            }
          } else {
            formData.authors = cardData.authors || [""];
          }

          formData.name = cardData.name || "";
          formData.description = cardData.description || "";
          formData.version = cardData.version || "";
          formData.url = cardData.url || "";
          formData.protocolVersion = cardData.protocolVersion || "";

          if (
            cardData.defaultInputModes &&
            Array.isArray(cardData.defaultInputModes)
          ) {
            formData.defaultInputModes =
              cardData.defaultInputModes.length > 0
                ? cardData.defaultInputModes
                : ["text"];
          } else {
            formData.defaultInputModes = ["text"];
          }

          if (
            cardData.defaultOutputModes &&
            Array.isArray(cardData.defaultOutputModes)
          ) {
            formData.defaultOutputModes =
              cardData.defaultOutputModes.length > 0
                ? cardData.defaultOutputModes
                : ["text"];
          } else {
            formData.defaultOutputModes = ["text"];
          }

          if (cardData.capabilities) {
            formData.capabilities_pushNotifications =
              !!cardData.capabilities.pushNotifications;
            formData.capabilities_streaming = !!cardData.capabilities.streaming;
          }

          if (cardData.skills && Array.isArray(cardData.skills)) {
            formData["skills"] = cardData.skills.map((skill) => ({
              id: skill.id || "",
              name: skill.name || "",
              description: skill.description || "",
              examples: skill.examples || [""],
              tags: skill.tags || [""],
            }));
          }

          if (cardData.oasfSkills && Array.isArray(cardData.oasfSkills)) {
            formData["oasf-skills"] = cardData.oasfSkills;
          }

          if (cardData.locators && Array.isArray(cardData.locators)) {
            formData.locators = cardData.locators;
          }

          return formData;
        };

        // Function to process the import after confirmation
        const processImport = (data) => {
          try {
            console.log("Processing import data:", data);

            // Check if it's an A2A card format
            if (isA2ACardFormat(data)) {
              console.log("Importing A2A card format");
              // Preserve the original A2A card data structure without modifications
              // Store the original data directly in the raw_data field
              const newExtension = {
                id: `a2a_${nextId}`,
                extensionType: "a2a",
                name: extensionConfigs.a2a.name,
                data: {
                  // Store the original data directly
                  raw_data: data,
                  // Also keep the converted data for backward compatibility with the form
                  ...convertA2ACardToExtensionData(data)
                },
                collapsed: "false",
                order: 0,
              };

              setActiveExtensions([newExtension]);
              setNextId((prev) => prev + 1);
              addToast("A2A Card imported successfully", "success");
              return;
            }

            // Check if it's an OASF record
            if (isOASFRecord(data)) {
              console.log("Importing OASF record with extensions", data);
              // Update the base OASF record information
              const baseRecordData = {
                name: data.name || "Generated Agent",
                description: data.description || "Agent generated using AGNTCY OASF Record Generator",
                version: data.version || "0.5.0",
                authors: data.authors || ["Cisco Outshift Contributors"],
                skills: data.skills || [],
                created_at: data.created_at || new Date().toISOString(),
                locators: data.locators || [],
                metadata: data.metadata || {
                  generator: "AGNTCY OASF Record Generator",
                  generated_at: new Date().toISOString(),
                }
              };

              // Update the OASF record state
              console.log("Setting OASF record data:", baseRecordData);
              setOasfRecord(baseRecordData);

              // Update the OASF version state (remove 'v' prefix if present)
              const versionString = data.version || "v0.5.0";
              console.log("Setting OASF version:", versionString.replace(/^v/, ""));
              setOasfVersion(versionString.replace(/^v/, ""));

              // Process extensions
              console.log("Processing extensions array:", data.extensions);
              const newExtensions = data.extensions
                .map((extension, index) => {
                  const schemaName = extension.schema || extension.name;
                  console.log(`Extension ${index} schema:`, schemaName);

                  // Enhanced schema matching logic
                  let extensionType = Object.keys(extensionConfigs).find(
                    (key) => extensionConfigs[key].schemaName === schemaName
                  );
                  console.log(`Initial extension type match for ${schemaName}:`, extensionType);

                  // If exact match not found, check alternate schemas
                  if (!extensionType) {
                    console.log(`No exact match found for ${schemaName}, checking alternate schemas`);
                    extensionType = Object.keys(extensionConfigs).find(key => {
                      // Check if this extension has alternate schemas
                      if (extensionConfigs[key].alternateSchemas &&
                          Array.isArray(extensionConfigs[key].alternateSchemas)) {
                        // Check if schema matches any of the alternates
                        const isMatch = extensionConfigs[key].alternateSchemas.includes(schemaName);
                        if (isMatch) {
                          console.log(`Found match in alternate schemas for ${key}:`, schemaName);
                        }
                        return isMatch;
                      }
                      return false;
                    });
                  }

                  // If still no match, try matching by schema pattern
                  if (!extensionType) {
                    console.log(`No alternate schema match found for ${schemaName}, trying pattern matching`);
                    extensionType = Object.keys(extensionConfigs).find(key => {
                      // Extract the feature name from schema
                      const configSchema = extensionConfigs[key].schemaName;
                      const schemaFeature = configSchema.split('/').pop();
                      const extensionFeature = schemaName ? schemaName.split('/').pop() : '';

                      console.log(`Comparing features for ${key}: ${schemaFeature} vs ${extensionFeature}`);

                      // Special case for MCP with runtime path
                      if (schemaName && schemaName.includes('/runtime/mcp') && key === 'mcp') {
                        console.log('Found MCP runtime schema, matching to MCP extension');
                        return true;
                      }

                      // Match if the feature names are the same
                      return schemaFeature === extensionFeature;
                    });
                  }

                  if (extensionType) {
                    console.log(`Matched extension: ${schemaName} to ${extensionType}`);
                    return {
                      id: `${extensionType}_${nextId + index}`,
                      extensionType,
                      name: extensionConfigs[extensionType].name,
                      data: extension.data || {},
                      collapsed: "false",
                      order: index,
                    };
                  } else {
                    console.log(`Could not match extension schema: ${schemaName}`);
                  }
                  return null;
                })
                .filter(Boolean);

              if (newExtensions.length > 0) {
                setActiveExtensions(newExtensions);
                setNextId((prev) => prev + newExtensions.length);
                addToast(
                  `Imported OASF record with ${newExtensions.length} extension(s)`,
                  "success"
                );
              } else {
                addToast(
                  "Imported OASF record but no compatible extensions were found",
                  "warning"
                );
              }
              return;
            }

            // For backward compatibility - check for features array (old format)
            if (data.features && Array.isArray(data.features)) {
              const newExtensions = data.features
                .map((feature, index) => {
                  const schemaName = feature.schema || feature.name;

                  // Enhanced schema matching logic
                  let extensionType = Object.keys(extensionConfigs).find(
                    (key) => extensionConfigs[key].schemaName === schemaName
                  );

                  // If exact match not found, try matching by schema pattern
                  if (!extensionType) {
                    extensionType = Object.keys(extensionConfigs).find(key => {
                      // Extract the feature name from schema
                      const configSchema = extensionConfigs[key].schemaName;
                      const schemaFeature = configSchema.split('/').pop();
                      const extensionFeature = schemaName.split('/').pop();

                      // Match if the feature names are the same
                      return schemaFeature === extensionFeature;
                    });
                  }

                  if (extensionType) {
                    console.log(`Matched feature: ${schemaName} to ${extensionType}`);
                    return {
                      id: `${extensionType}_${nextId + index}`,
                      extensionType,
                      name: extensionConfigs[extensionType].name,
                      data: feature.data || {},
                      collapsed: "false",
                      order: index,
                    };
                  } else {
                    console.log(`Could not match feature schema: ${schemaName}`);
                  }
                  return null;
                })
                .filter(Boolean);

              if (newExtensions.length > 0) {
                setActiveExtensions(newExtensions);
                setNextId((prev) => prev + newExtensions.length);
                addToast(
                  `Imported ${newExtensions.length} extension(s) from OASF record`,
                  "success"
                );
              } else {
                addToast(
                  "No compatible extensions found in the OASF record",
                  "warning"
                );
              }
              return;
            }

            addToast(
              "Invalid JSON format. Please select an A2A card or OASF record file.",
              "error"
            );
          } catch (error) {
            console.error("JSON parsing error:", error);
            addToast(
              "Invalid JSON file. Please check the file format.",
              "error"
            );
          }
        };

        // Function to handle file import button click
        const importJson = () => {
          const input = document.createElement("input");
          input.type = "file";
          input.accept = ".json";
          input.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const data = JSON.parse(e.target.result);
                // Show confirmation dialog
                setImportFileData(data);
                setShowConfirmDialog(true);
              } catch (error) {
                console.error("JSON parsing error:", error);
                addToast(
                  "Invalid JSON file. Please check the file format.",
                  "error"
                );
              }
            };
            reader.readAsText(file);
          };
          input.click();
        };
        // Handle confirmation dialog actions
        const handleConfirmImport = () => {
          if (importFileData) {
            processImport(importFileData);
            setImportFileData(null);
          }
          setShowConfirmDialog(false);
        };

        const handleCancelImport = () => {
          setImportFileData(null);
          setShowConfirmDialog(false);
        };

        return (
          <div className="container mx-auto py-8" ref={appContainerRef}>
            {/* Drop zone message */}
            <div className="drop-zone-message">
              <h3 className="text-xl font-semibold mb-2">Drop JSON File Here</h3>
              <p>Drop your OASF record or A2A card JSON file to import</p>
            </div>

            {/* Confirmation Dialog */}
            <ConfirmDialog
              isOpen={showConfirmDialog}
              onConfirm={handleConfirmImport}
              onCancel={handleCancelImport}
              title="Import JSON"
              message="Are you sure you want to import this file? All current data will be replaced."
            />
            {/* Back to Top Button */}
            {showBackToTop && (
              <button
                onClick={scrollToTop}
                className="fixed bottom-8 right-8 bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-full shadow-lg z-50 transition-all duration-300 transform hover:scale-110 focus:outline-none dark:bg-blue-600 dark:hover:bg-blue-700"
                aria-label="Back to top"
              >
                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 10l7-7m0 0l7 7m-7-7v18" />
                </svg>
              </button>
            )}
            {/* Theme Toggle */}
            <ThemeToggle />

            {/* Header */}
            <div
              className="sticky top-0 left-0 right-0 z-10 card rounded-2xl shadow-lg py-4 px-6 mb-8 dark:text-gray-800"
            >
              <div className="container mx-auto flex justify-between items-center">
                <div className="flex items-center">
                  <img
                    src="https://agntcy.org/images/logo.png"
                    alt="AGNTCY Logo"
                    className="h-10 w-auto mr-4"
                  />
                  <div>
                    <h1 className="text-2xl font-bold">OASF Record Generator</h1>
                    <span className="text-xs">
                      Using <a
                        href={`https://schema.oasf.outshift.com/${oasfVersion}`}
                        target="_blank"
                        className="text-primary hover:underline dark:text-white"
                      >
                        OASF Schema v{oasfVersion}
                      </a>
                    </span>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  <button
                    className="btn btn-secondary"
                    onClick={importJson}
                  >
                    Import JSON
                  </button>
                  <button
                    className="btn btn-primary"
                    onClick={handleGenerateOASF}
                  >
                    Generate OASF Record
                  </button>
                </div>
              </div>
              <p className="text-sm ml-4">
                Build comprehensive OASF records by adding and configuring extensions
              </p>
            </div>
            {/* Extension Gallery */}
            <div className="mb-8">
              <h3 className="text-lg font-semibold mb-4">
                Available Extensions
              </h3>
              <ExtensionGallery
                extensions={availableExtensions}
                onAddExtension={addExtension}
                isLoading={isSchemaLoading}
              />
            </div>

           {/* OASF Base Record Editor always at top */}
           <OasfBaseRecordEditor
              record={oasfRecord}
              onChange={setOasfRecord}
              minimized={oasfEditorMinimized}
              onToggleMin={() => setOasfEditorMinimized((prev) => !prev)}
            />
            {/* Active Extensions */}
            <div className="mb-8">
              <div className="flex items-center justify-between mb-6">
                <div className="flex items-center gap-4">
                <h2 className="text-2xl font-semibold">Active Extensions</h2>
                  {activeExtensions.length > 0 && (
                    <div className="flex items-center gap-2">
                      <button
                        className="btn btn-ghost btn-small"
                        onClick={collapseAllExtensions}
                        title="Collapse all extensions"
                      >
                        🔼 Collapse All
                      </button>
                      <button
                        className="btn btn-ghost btn-small"
                        onClick={expandAllExtensions}
                        title="Expand all extensions"
                      >
                        🔽 Expand All
                      </button>
                    </div>
                  )}
                </div>
              </div>
              {activeExtensions.length === 0 ? (
                <div className="card p-8 text-center">
                  <div className="text-6xl mb-4">📦</div>
                  <h3 className="text-xl font-semibold mb-2">
                    No Extensions Added
                  </h3>
                  <p className="text-muted-foreground">
                    Click on an extension above to add it to your OASF record
                  </p>
                </div>
              ) : (
                <div className="space-y-4">
                  {activeExtensions.map((extension) => (
                    <ExtensionCard
                      key={extension.id}
                      extension={extension}
                      onUpdate={updateExtension}
                      onRemove={removeExtension}
                      onDuplicate={duplicateExtension}
                      onToggle={toggleExtension}
                    />
                  ))}
                </div>
              )}
            </div>
            {/* JSON Preview Modal */}
            <JsonPreview
              extensions={activeExtensions}
              isVisible={showPreview}
              onClose={() => setShowPreview(false)}
              oasfRecord={oasfRecord}
            />

            {/* Footer */}
            {React.createElement(
              "footer",
              {
                style: {
                  marginTop: "30px",
                  textAlign: "center",
                  padding: "15px",
                  borderTop: "1px solid rgba(0,0,0,0.1)",
                  fontSize: "14px",
                },
              },
              [
                React.createElement(
                  "div",
                  {
                    style: {
                      padding: "16px",
                      marginBottom: "24px",
                      background: "var(--primary-light)",
                      borderRadius: "var(--radius)",
                      fontSize: "0.875rem",
                      textAlign: "center",
                      border: "1px solid var(--border-color)",
                      color: "var(--fg)",
                    },
                  },
                  "🔒 This is a browser-only tool. No data is transmitted outside of your browser. 🔒"
                ),
                React.createElement("p", {}, [
                  React.createElement("span", { key: "text-1" }, "✨ Created with "),
                  React.createElement(
                    "span",
                    { key: "heart", style: { color: "#ff6b6b" } },
                    "❤️"
                  ),
                  React.createElement("span", { key: "text-2" }, " by "),
                  React.createElement(
                    "a",
                    {
                      key: "link",
                      href: "https://outshift.cisco.com",
                      target: "_blank",
                      style: { textDecoration: "none" },
                    },
                    "👨‍💻 Cisco Outshift Contributors"
                  ),
                  React.createElement("span", { key: "text-3" }, " ✨"),
                ]),
                React.createElement("p", { style: { marginTop: "10px" } }, [
                  React.createElement("span", { key: "source-text" }, "🔍 Source code: "),
                  React.createElement(
                    "a",
                    {
                      key: "source-link",
                      href: "https://github.com/sriaradhyula/generate-agntcy-oasf-card",
                      target: "_blank",
                      style: {
                        textDecoration: "underline",
                        color: "var(--primary)",
                      },
                    },
                    "github.com/sriaradhyula/generate-agntcy-oasf-card"
                  ),
                ]),
              ]
            )}

            {/* Toast Container */}
            <ToastContainer toasts={toasts} removeToast={removeToast} />
          </div>
        );
      }
      // Use createRoot API for React 18
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
